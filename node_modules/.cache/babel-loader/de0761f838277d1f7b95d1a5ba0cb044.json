{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"onStart\", \"onStartX\", \"onStartY\", \"onMove\", \"onMoveX\", \"onMoveY\", \"onLeave\", \"onEnter\", \"onEnd\", \"onEndX\", \"onEndY\", \"onClickCapture\", \"usePointerHover\", \"slideThreshold\", \"useCapture\", \"Component\", \"getRootRef\", \"noSlideClick\", \"stopPropagation\"];\nimport * as React from 'react';\nimport { getSupportedEvents, coordX, coordY, touchEnabled } from '../../lib/touch';\nimport { useDOM } from '../../lib/dom';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\n/**\n * @see https://vkcom.github.io/VKUI/#/Touch\n */\n\nexport var Touch = function Touch(_ref) {\n  var onStart = _ref.onStart,\n      onStartX = _ref.onStartX,\n      onStartY = _ref.onStartY,\n      _onMove = _ref.onMove,\n      onMoveX = _ref.onMoveX,\n      onMoveY = _ref.onMoveY,\n      onLeave = _ref.onLeave,\n      onEnter = _ref.onEnter,\n      _onEnd = _ref.onEnd,\n      onEndX = _ref.onEndX,\n      onEndY = _ref.onEndY,\n      onClickCapture = _ref.onClickCapture,\n      usePointerHover = _ref.usePointerHover,\n      _ref$slideThreshold = _ref.slideThreshold,\n      slideThreshold = _ref$slideThreshold === void 0 ? 5 : _ref$slideThreshold,\n      _ref$useCapture = _ref.useCapture,\n      useCapture = _ref$useCapture === void 0 ? false : _ref$useCapture,\n      _ref$Component = _ref.Component,\n      Component = _ref$Component === void 0 ? 'div' : _ref$Component,\n      getRootRef = _ref.getRootRef,\n      _ref$noSlideClick = _ref.noSlideClick,\n      noSlideClick = _ref$noSlideClick === void 0 ? false : _ref$noSlideClick,\n      _ref$stopPropagation = _ref.stopPropagation,\n      stopPropagation = _ref$stopPropagation === void 0 ? false : _ref$stopPropagation,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  var _useDOM = useDOM(),\n      document = _useDOM.document;\n\n  var events = React.useMemo(getSupportedEvents, []);\n  var didSlide = React.useRef(false);\n  var gesture = React.useRef(null);\n\n  var handle = function handle(e, handlers) {\n    stopPropagation && e.stopPropagation();\n    handlers.forEach(function (cb) {\n      var _gesture$current$star, _gesture$current, _gesture$current$star2;\n\n      var duration = Date.now() - ((_gesture$current$star = (_gesture$current = gesture.current) === null || _gesture$current === void 0 ? void 0 : (_gesture$current$star2 = _gesture$current.startT) === null || _gesture$current$star2 === void 0 ? void 0 : _gesture$current$star2.getTime()) !== null && _gesture$current$star !== void 0 ? _gesture$current$star : 0);\n      cb && cb(_objectSpread(_objectSpread({}, gesture.current), {}, {\n        duration: duration,\n        originalEvent: e\n      }));\n    });\n  };\n\n  var enterHandler = useEventListener(usePointerHover ? 'pointerenter' : 'mouseenter', onEnter);\n  var leaveHandler = useEventListener(usePointerHover ? 'pointerleave' : 'mouseleave', onLeave);\n  var startHandler = useEventListener(events[0], function (e) {\n    gesture.current = initGesture(coordX(e), coordY(e));\n    handle(e, [onStart, onStartX, onStartY]); // 1 line, 2 bad specs, 2 workarounds:\n\n    subscribe(touchEnabled() ? // Touch events fire on initial target, and won't bubble if its removed\n    // see: #235, #1968, https://stackoverflow.com/a/45760014\n    e.target : // Mouse events fire on the element under pointer, so we lose move / end\n    // if pointer goes outside container.\n    // Can be fixed by PointerEvents' setPointerCapture later\n    document);\n  }, {\n    capture: useCapture,\n    passive: false\n  });\n  var containerRef = useExternRef(getRootRef);\n  useIsomorphicLayoutEffect(function () {\n    var el = containerRef.current;\n\n    if (el) {\n      enterHandler.add(el);\n      leaveHandler.add(el);\n      startHandler.add(el);\n    }\n  }, [Component]);\n\n  function onMove(e) {\n    var _gesture$current2;\n\n    var _ref2 = (_gesture$current2 = gesture.current) !== null && _gesture$current2 !== void 0 ? _gesture$current2 : {},\n        isPressed = _ref2.isPressed,\n        isX = _ref2.isX,\n        isY = _ref2.isY,\n        _ref2$startX = _ref2.startX,\n        startX = _ref2$startX === void 0 ? 0 : _ref2$startX,\n        _ref2$startY = _ref2.startY,\n        startY = _ref2$startY === void 0 ? 0 : _ref2$startY;\n\n    if (isPressed) {\n      var _gesture$current3; // смещения\n\n\n      var shiftX = coordX(e) - startX;\n      var shiftY = coordY(e) - startY; // абсолютные значения смещений\n\n      var shiftXAbs = Math.abs(shiftX);\n      var shiftYAbs = Math.abs(shiftY); // Если определяем мультитач, то прерываем жест\n\n      if (!!e.touches && e.touches.length > 1) {\n        return onEnd(e);\n      } // если мы ещё не определились\n\n\n      if (!isX && !isY) {\n        var willBeX = shiftXAbs >= slideThreshold && shiftXAbs > shiftYAbs;\n        var willBeY = shiftYAbs >= slideThreshold && shiftYAbs > shiftXAbs;\n        var willBeSlidedX = willBeX && (!!onMoveX || !!_onMove);\n        var willBeSlidedY = willBeY && (!!onMoveY || !!_onMove);\n\n        if (gesture.current) {\n          Object.assign(gesture.current, {\n            isY: willBeY,\n            isX: willBeX,\n            isSlideX: willBeSlidedX,\n            isSlideY: willBeSlidedY,\n            isSlide: willBeSlidedX || willBeSlidedY\n          });\n        }\n      }\n\n      if ((_gesture$current3 = gesture.current) !== null && _gesture$current3 !== void 0 && _gesture$current3.isSlide) {\n        Object.assign(gesture.current, {\n          shiftX: shiftX,\n          shiftY: shiftY,\n          shiftXAbs: shiftXAbs,\n          shiftYAbs: shiftYAbs\n        });\n        handle(e, [_onMove, gesture.current.isSlideX && onMoveX, gesture.current.isSlideY && onMoveY]);\n      }\n    }\n  }\n\n  function onEnd(e) {\n    var _gesture$current4;\n\n    var _ref3 = (_gesture$current4 = gesture.current) !== null && _gesture$current4 !== void 0 ? _gesture$current4 : {},\n        isPressed = _ref3.isPressed,\n        isSlide = _ref3.isSlide,\n        isSlideX = _ref3.isSlideX,\n        isSlideY = _ref3.isSlideY;\n\n    if (isPressed) {\n      handle(e, [_onEnd, isSlideY && onEndY, isSlideX && onEndX]);\n    }\n\n    didSlide.current = Boolean(isSlide);\n    gesture.current = {}; // Если это был тач-евент, симулируем отмену hover\n\n    if (touchEnabled()) {\n      onLeave && onLeave(e);\n    }\n\n    unsubscribe();\n  }\n\n  var listenerParams = {\n    capture: useCapture,\n    passive: false\n  };\n  var listeners = [useEventListener(events[1], onMove, listenerParams), useEventListener(events[2], onEnd, listenerParams), useEventListener(events[3], onEnd, listenerParams)];\n\n  function subscribe(el) {\n    if (el) {\n      listeners.forEach(function (l) {\n        return l.add(el);\n      });\n    }\n  }\n\n  function unsubscribe() {\n    listeners.forEach(function (l) {\n      return l.remove();\n    });\n  }\n  /**\n   * Обработчик событий dragstart\n   * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n   */\n\n\n  var onDragStart = function onDragStart(e) {\n    var target = e.target;\n\n    if (target.tagName === 'A' || target.tagName === 'IMG') {\n      e.preventDefault();\n    }\n  };\n  /**\n   * Обработчик клика по компоненту\n   * Отменяет переход по вложенной ссылке, если был зафиксирован свайп\n   */\n\n\n  var postGestureClick = function postGestureClick(e) {\n    if (!didSlide.current) {\n      return onClickCapture && onClickCapture(e);\n    } // eslint-disable-next-line no-restricted-properties\n\n\n    if (e.target.closest('a')) {\n      e.preventDefault();\n    }\n\n    if (noSlideClick) {\n      e.stopPropagation();\n    } else {\n      onClickCapture && onClickCapture(e);\n    }\n\n    didSlide.current = false;\n  };\n\n  return /*#__PURE__*/React.createElement(Component, _extends({}, restProps, {\n    onDragStart: onDragStart,\n    onClickCapture: postGestureClick,\n    ref: containerRef\n  }));\n};\n\nfunction initGesture(startX, startY) {\n  return {\n    startX: startX,\n    startY: startY,\n    startT: new Date(),\n    duration: 0,\n    isPressed: true,\n    isY: false,\n    isX: false,\n    isSlideX: false,\n    isSlideY: false,\n    isSlide: false,\n    shiftX: 0,\n    shiftY: 0,\n    shiftXAbs: 0,\n    shiftYAbs: 0\n  };\n}","map":{"version":3,"mappings":"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","names":["React","getSupportedEvents","coordX","coordY","touchEnabled","useDOM","useExternRef","useEventListener","useIsomorphicLayoutEffect","Touch","_ref","onStart","onStartX","onStartY","_onMove","onMove","onMoveX","onMoveY","onLeave","onEnter","_onEnd","onEnd","onEndX","onEndY","onClickCapture","usePointerHover","_ref$slideThreshold","slideThreshold","_ref$useCapture","useCapture","_ref$Component","Component","getRootRef","_ref$noSlideClick","noSlideClick","_ref$stopPropagation","stopPropagation","restProps","document","events","useMemo","didSlide","useRef","gesture","handle","e","handlers","forEach","cb","duration","Date","now","current","_gesture$current","startT","_gesture$current$star2","getTime","_gesture$current$star","originalEvent","enterHandler","leaveHandler","startHandler","initGesture","subscribe","target","capture","passive","containerRef","el","add","_gesture$current2","isPressed","isX","isY","_ref2$startX","startX","_ref2$startY","startY","shiftX","shiftY","shiftXAbs","Math","abs","shiftYAbs","touches","length","willBeX","willBeY","willBeSlidedX","willBeSlidedY","Object","assign","isSlideX","isSlideY","isSlide","_gesture$current3","_gesture$current4","Boolean","unsubscribe","listenerParams","listeners","l","remove","onDragStart","tagName","preventDefault","postGestureClick","closest","_extends","ref"],"sources":["/Users/pitus_anonimous/Desktop/youth_bit_hack/youth_bit_vk/node_modules/@vkontakte/vkui/src/components/Touch/Touch.tsx"],"sourcesContent":["import * as React from 'react';\nimport { getSupportedEvents, coordX, coordY, touchEnabled, VKUITouchEvent } from '../../lib/touch';\nimport { HasComponent, HasRootRef } from '../../types';\nimport { useDOM } from '../../lib/dom';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\n\nexport interface TouchProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    HasRootRef<HTMLElement>,\n    HasComponent {\n  /**\n   * Привязать onEnter и onLeave через pointer-events - работает на disabled-инпутах\n   */\n  usePointerHover?: boolean;\n  useCapture?: boolean;\n  slideThreshold?: number;\n  noSlideClick?: boolean;\n  onEnter?: HoverHandler;\n  onLeave?: HoverHandler;\n  onStart?: TouchEventHandler;\n  onStartX?: TouchEventHandler;\n  onStartY?: TouchEventHandler;\n  onMove?: TouchEventHandler;\n  onMoveX?: TouchEventHandler;\n  onMoveY?: TouchEventHandler;\n  onEnd?: TouchEventHandler;\n  onEndX?: TouchEventHandler;\n  onEndY?: TouchEventHandler;\n  stopPropagation?: boolean;\n}\n\nexport interface Gesture {\n  startX: number;\n  startY: number;\n  startT: Date;\n  duration: number;\n  isPressed: boolean;\n  isY: boolean;\n  isX: boolean;\n  isSlideX: boolean;\n  isSlideY: boolean;\n  isSlide: boolean;\n  shiftX: number;\n  shiftY: number;\n  shiftXAbs: number;\n  shiftYAbs: number;\n}\n\nexport interface TouchEvent extends Gesture {\n  originalEvent: VKUITouchEvent;\n}\n\ntype HoverHandler = (outputEvent: MouseEvent) => void;\nexport type TouchEventHandler = (e: TouchEvent) => void;\nexport type ClickHandler = (e: React.MouseEvent<HTMLElement>) => void;\nexport type DragHandler = (e: React.DragEvent<HTMLElement>) => void;\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Touch\n */\nexport const Touch = ({\n  onStart,\n  onStartX,\n  onStartY,\n  onMove: _onMove,\n  onMoveX,\n  onMoveY,\n  onLeave,\n  onEnter,\n  onEnd: _onEnd,\n  onEndX,\n  onEndY,\n  onClickCapture,\n  usePointerHover,\n  slideThreshold = 5,\n  useCapture = false,\n  Component = 'div',\n  getRootRef,\n  noSlideClick = false,\n  stopPropagation = false,\n  ...restProps\n}: TouchProps) => {\n  const { document } = useDOM();\n  const events = React.useMemo(getSupportedEvents, []);\n  const didSlide = React.useRef(false);\n  const gesture = React.useRef<Partial<Gesture> | null>(null);\n  const handle = (e: VKUITouchEvent, handlers: Array<TouchEventHandler | undefined | false>) => {\n    stopPropagation && e.stopPropagation();\n    handlers.forEach((cb) => {\n      const duration = Date.now() - (gesture.current?.startT?.getTime() ?? 0);\n      cb && cb({ ...(gesture.current as Gesture), duration, originalEvent: e });\n    });\n  };\n\n  const enterHandler = useEventListener(usePointerHover ? 'pointerenter' : 'mouseenter', onEnter);\n  const leaveHandler = useEventListener(usePointerHover ? 'pointerleave' : 'mouseleave', onLeave);\n  const startHandler = useEventListener(\n    events[0],\n    (e: VKUITouchEvent) => {\n      gesture.current = initGesture(coordX(e), coordY(e));\n\n      handle(e, [onStart, onStartX, onStartY]);\n      // 1 line, 2 bad specs, 2 workarounds:\n      subscribe(\n        touchEnabled()\n          ? // Touch events fire on initial target, and won't bubble if its removed\n            // see: #235, #1968, https://stackoverflow.com/a/45760014\n            (e.target as HTMLElement)\n          : // Mouse events fire on the element under pointer, so we lose move / end\n            // if pointer goes outside container.\n            // Can be fixed by PointerEvents' setPointerCapture later\n            document,\n      );\n    },\n    { capture: useCapture, passive: false },\n  );\n  const containerRef = useExternRef(getRootRef);\n\n  useIsomorphicLayoutEffect(() => {\n    const el = containerRef.current;\n    if (el) {\n      enterHandler.add(el);\n      leaveHandler.add(el);\n      startHandler.add(el);\n    }\n  }, [Component]);\n\n  function onMove(e: VKUITouchEvent) {\n    const { isPressed, isX, isY, startX = 0, startY = 0 } = gesture.current ?? {};\n\n    if (isPressed) {\n      // смещения\n      const shiftX = coordX(e) - startX;\n      const shiftY = coordY(e) - startY;\n\n      // абсолютные значения смещений\n      const shiftXAbs = Math.abs(shiftX);\n      const shiftYAbs = Math.abs(shiftY);\n\n      // Если определяем мультитач, то прерываем жест\n      if (!!e.touches && e.touches.length > 1) {\n        return onEnd(e);\n      }\n\n      // если мы ещё не определились\n      if (!isX && !isY) {\n        const willBeX = shiftXAbs >= slideThreshold && shiftXAbs > shiftYAbs;\n        const willBeY = shiftYAbs >= slideThreshold && shiftYAbs > shiftXAbs;\n        const willBeSlidedX = willBeX && (!!onMoveX || !!_onMove);\n        const willBeSlidedY = willBeY && (!!onMoveY || !!_onMove);\n\n        if (gesture.current) {\n          Object.assign(gesture.current, {\n            isY: willBeY,\n            isX: willBeX,\n            isSlideX: willBeSlidedX,\n            isSlideY: willBeSlidedY,\n            isSlide: willBeSlidedX || willBeSlidedY,\n          });\n        }\n      }\n\n      if (gesture.current?.isSlide) {\n        Object.assign(gesture.current, {\n          shiftX,\n          shiftY,\n          shiftXAbs,\n          shiftYAbs,\n        });\n\n        handle(e, [\n          _onMove,\n          gesture.current.isSlideX && onMoveX,\n          gesture.current.isSlideY && onMoveY,\n        ]);\n      }\n    }\n  }\n\n  function onEnd(e: VKUITouchEvent) {\n    const { isPressed, isSlide, isSlideX, isSlideY } = gesture.current ?? {};\n\n    if (isPressed) {\n      handle(e, [_onEnd, isSlideY && onEndY, isSlideX && onEndX]);\n    }\n\n    didSlide.current = Boolean(isSlide);\n    gesture.current = {};\n\n    // Если это был тач-евент, симулируем отмену hover\n    if (touchEnabled()) {\n      onLeave && onLeave(e);\n    }\n    unsubscribe();\n  }\n\n  const listenerParams = { capture: useCapture, passive: false };\n  const listeners = [\n    useEventListener(events[1], onMove, listenerParams),\n    useEventListener(events[2], onEnd, listenerParams),\n    useEventListener(events[3], onEnd, listenerParams),\n  ];\n  function subscribe(el: HTMLElement | Document | null | undefined) {\n    if (el) {\n      listeners.forEach((l) => l.add(el));\n    }\n  }\n  function unsubscribe() {\n    listeners.forEach((l) => l.remove());\n  }\n\n  /**\n   * Обработчик событий dragstart\n   * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n   */\n  const onDragStart = (e: React.DragEvent<HTMLElement>) => {\n    const target = e.target as HTMLElement;\n    if (target.tagName === 'A' || target.tagName === 'IMG') {\n      e.preventDefault();\n    }\n  };\n\n  /**\n   * Обработчик клика по компоненту\n   * Отменяет переход по вложенной ссылке, если был зафиксирован свайп\n   */\n  const postGestureClick: typeof onClickCapture = (e) => {\n    if (!didSlide.current) {\n      return onClickCapture && onClickCapture(e);\n    }\n    // eslint-disable-next-line no-restricted-properties\n    if ((e.target as HTMLElement).closest('a')) {\n      e.preventDefault();\n    }\n    if (noSlideClick) {\n      e.stopPropagation();\n    } else {\n      onClickCapture && onClickCapture(e);\n    }\n    didSlide.current = false;\n  };\n\n  return (\n    <Component\n      {...restProps}\n      onDragStart={onDragStart}\n      onClickCapture={postGestureClick}\n      ref={containerRef}\n    />\n  );\n};\n\nfunction initGesture(startX: number, startY: number): Gesture {\n  return {\n    startX,\n    startY,\n    startT: new Date(),\n    duration: 0,\n    isPressed: true,\n    isY: false,\n    isX: false,\n    isSlideX: false,\n    isSlideY: false,\n    isSlide: false,\n    shiftX: 0,\n    shiftY: 0,\n    shiftXAbs: 0,\n    shiftYAbs: 0,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}