{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"Component\", \"onClose\", \"restoreFocus\", \"timeout\", \"getRootRef\", \"children\"];\nimport * as React from 'react';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from '../../lib/accessibility';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { AppRootContext } from '../AppRoot/AppRootContext';\nvar FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS_LIST.join();\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\n\nexport var FocusTrap = function FocusTrap(_ref) {\n  var _ref$Component = _ref.Component,\n      Component = _ref$Component === void 0 ? 'div' : _ref$Component,\n      onClose = _ref.onClose,\n      _ref$restoreFocus = _ref.restoreFocus,\n      restoreFocus = _ref$restoreFocus === void 0 ? true : _ref$restoreFocus,\n      _ref$timeout = _ref.timeout,\n      timeout = _ref$timeout === void 0 ? 0 : _ref$timeout,\n      getRootRef = _ref.getRootRef,\n      children = _ref.children,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  var ref = useExternRef(getRootRef);\n\n  var _useDOM = useDOM(),\n      document = _useDOM.document,\n      window = _useDOM.window;\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      focusableNodes = _React$useState2[0],\n      setFocusableNodes = _React$useState2[1];\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      restoreFocusTo = _React$useState4[0],\n      setRestoreFocusTo = _React$useState4[1]; // HANDLE TRAP MOUNT\n\n\n  var _React$useContext = React.useContext(AppRootContext),\n      keyboardInput = _React$useContext.keyboardInput;\n\n  var focusOnTrapMount = useTimeout(function () {\n    var _ref$current;\n\n    if (keyboardInput && !((_ref$current = ref.current) !== null && _ref$current !== void 0 && _ref$current.contains(document.activeElement)) && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    focusOnTrapMount.set();\n  }, []); // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(function () {\n    if (!ref.current) {\n      return;\n    }\n\n    var nodes = [];\n    Array.prototype.forEach.call( // eslint-disable-next-line no-restricted-properties\n    ref.current.querySelectorAll(FOCUSABLE_ELEMENTS), function (focusableEl) {\n      var _getComputedStyle = window.getComputedStyle(focusableEl),\n          display = _getComputedStyle.display,\n          visibility = _getComputedStyle.visibility;\n\n      if (display !== 'none' && visibility !== 'hidden') {\n        nodes.push(focusableEl);\n      }\n    });\n\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n\n    setFocusableNodes(nodes);\n  }, [children]); // HANDLE TRAP UNMOUNT\n\n  var focusOnTrapUnmount = useTimeout(function () {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    if (restoreFocus && document.activeElement) {\n      setRestoreFocusTo(document.activeElement);\n      return function () {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return;\n  }, [restoreFocus]);\n\n  var onDocumentKeydown = function onDocumentKeydown(e) {\n    if (pressedKey(e) === Keys.TAB && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      var lastIdx = focusableNodes.length - 1;\n      var targetIdx = focusableNodes.findIndex(function (node) {\n        return node === e.target;\n      });\n      var shouldFocusFirstNode = targetIdx === -1 || targetIdx === lastIdx && !e.shiftKey;\n\n      if (shouldFocusFirstNode || targetIdx === 0 && e.shiftKey) {\n        e.preventDefault();\n        var node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n\n  useGlobalEventListener(document, 'keydown', onDocumentKeydown, {\n    capture: true\n  });\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    tabIndex: -1,\n    ref: ref\n  }, restProps), children);\n};","map":{"version":3,"mappings":"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","names":["React","useExternRef","useGlobalEventListener","useTimeout","FOCUSABLE_ELEMENTS_LIST","Keys","pressedKey","useDOM","useIsomorphicLayoutEffect","AppRootContext","FOCUSABLE_ELEMENTS","join","FocusTrap","_ref","Component","_ref$Component","onClose","_ref$restoreFocus","restoreFocus","_ref$timeout","timeout","getRootRef","children","restProps","ref","document","window","useState","_React$useState2","focusableNodes","setFocusableNodes","_React$useState4","restoreFocusTo","setRestoreFocusTo","useContext","keyboardInput","focusOnTrapMount","current","_ref$current","contains","activeElement","length","focus","set","nodes","Array","prototype","forEach","call","querySelectorAll","focusableEl","getComputedStyle","display","visibility","push","focusOnTrapUnmount","onDocumentKeydown","e","TAB","lastIdx","targetIdx","findIndex","node","target","shouldFocusFirstNode","shiftKey","preventDefault","ESCAPE","capture","_extends","tabIndex"],"sources":["/Users/pitus_anonimous/Desktop/youth_bit_hack/youth_bit_vk/node_modules/@vkontakte/vkui/src/components/FocusTrap/FocusTrap.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from '../../lib/accessibility';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HasComponent, HasRootRef } from '../../types';\nimport { AppRootContext } from '../AppRoot/AppRootContext';\n\nconst FOCUSABLE_ELEMENTS: string = FOCUSABLE_ELEMENTS_LIST.join();\nexport interface FocusTrapProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    HasRootRef<HTMLElement>,\n    HasComponent {\n  restoreFocus?: boolean;\n  timeout?: number;\n  onClose?(): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\nexport const FocusTrap = ({\n  Component = 'div',\n  onClose,\n  restoreFocus = true,\n  timeout = 0,\n  getRootRef,\n  children,\n  ...restProps\n}: FocusTrapProps) => {\n  const ref = useExternRef<HTMLElement>(getRootRef);\n\n  const { document, window } = useDOM();\n\n  const [focusableNodes, setFocusableNodes] = React.useState<HTMLElement[] | null>(null);\n  const [restoreFocusTo, setRestoreFocusTo] = React.useState<HTMLElement | null>(null);\n\n  // HANDLE TRAP MOUNT\n\n  const { keyboardInput } = React.useContext(AppRootContext);\n  const focusOnTrapMount = useTimeout(() => {\n    if (\n      keyboardInput &&\n      !ref.current?.contains(document!.activeElement) &&\n      focusableNodes?.length\n    ) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    focusOnTrapMount.set();\n  }, []);\n\n  // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const nodes: HTMLElement[] = [];\n    Array.prototype.forEach.call(\n      // eslint-disable-next-line no-restricted-properties\n      ref.current.querySelectorAll(FOCUSABLE_ELEMENTS),\n      (focusableEl: Element) => {\n        const { display, visibility } = window!.getComputedStyle(focusableEl);\n\n        if (display !== 'none' && visibility !== 'hidden') {\n          nodes.push(focusableEl as HTMLElement);\n        }\n      },\n    );\n\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n\n    setFocusableNodes(nodes);\n  }, [children]);\n\n  // HANDLE TRAP UNMOUNT\n\n  const focusOnTrapUnmount = useTimeout(() => {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    if (restoreFocus && document!.activeElement) {\n      setRestoreFocusTo(document!.activeElement as HTMLElement);\n\n      return () => {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return;\n  }, [restoreFocus]);\n\n  const onDocumentKeydown = (e: KeyboardEvent) => {\n    if (pressedKey(e) === Keys.TAB && focusableNodes?.length) {\n      const lastIdx = focusableNodes.length - 1;\n      const targetIdx = focusableNodes.findIndex((node) => node === e.target);\n\n      const shouldFocusFirstNode = targetIdx === -1 || (targetIdx === lastIdx && !e.shiftKey);\n\n      if (shouldFocusFirstNode || (targetIdx === 0 && e.shiftKey)) {\n        e.preventDefault();\n\n        const node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document!.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n  useGlobalEventListener(document, 'keydown', onDocumentKeydown, {\n    capture: true,\n  });\n\n  return (\n    <Component tabIndex={-1} ref={ref} {...restProps}>\n      {children}\n    </Component>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}