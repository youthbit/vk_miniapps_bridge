{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _excluded = [\"id\"];\nimport * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withContext } from '../../hoc/withContext';\nimport { ModalRootContext } from './ModalRootContext';\nimport { ConfigProviderContext, WebviewType } from '../ConfigProvider/ConfigProviderContext';\nimport { Platform } from '../../lib/platform';\nimport { withDOM } from '../../lib/dom';\nimport { getNavId } from '../../lib/getNavId';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { withModalManager } from './useModalManager';\nimport { clamp } from '../../helpers/math';\nvar warn = warnOnce('ModalRoot');\n\nvar ModalRootDesktopComponent = /*#__PURE__*/function (_React$Component) {\n  _inherits(ModalRootDesktopComponent, _React$Component);\n\n  var _super = _createSuper(ModalRootDesktopComponent);\n\n  function ModalRootDesktopComponent(props) {\n    var _this;\n\n    _classCallCheck(this, ModalRootDesktopComponent);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"maskElementRef\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"maskAnimationFrame\", undefined);\n\n    _defineProperty(_assertThisInitialized(_this), \"modalRootContext\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"restoreFocusTo\", undefined);\n\n    _this.maskElementRef = /*#__PURE__*/React.createRef();\n    _this.modalRootContext = {\n      updateModalHeight: function updateModalHeight() {\n        return undefined;\n      },\n      registerModal: function registerModal(_ref) {\n        var _this$getModalState;\n\n        var id = _ref.id,\n            data = _objectWithoutProperties(_ref, _excluded);\n\n        return Object.assign((_this$getModalState = _this.getModalState(id)) !== null && _this$getModalState !== void 0 ? _this$getModalState : {}, data);\n      },\n      onClose: function onClose() {\n        return _this.props.onExit();\n      },\n      isInsideModal: true\n    };\n    return _this;\n  }\n\n  _createClass(ModalRootDesktopComponent, [{\n    key: \"timeout\",\n    get: function get() {\n      return this.props.platform === Platform.IOS ? 400 : 320;\n    }\n  }, {\n    key: \"modals\",\n    get: function get() {\n      return React.Children.toArray(this.props.children);\n    }\n  }, {\n    key: \"getModalState\",\n    value: function getModalState(id) {\n      if (id === null) {\n        return undefined;\n      }\n\n      return this.props.getModalState(id);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // transition phase 2: animate exiting modal\n      if (this.props.exitingModal && this.props.exitingModal !== prevProps.exitingModal) {\n        this.closeModal(this.props.exitingModal);\n      } // transition phase 3: animate entering modal\n\n\n      if (this.props.enteringModal && this.props.enteringModal !== prevProps.enteringModal) {\n        this.openModal(prevProps);\n      } // focus restoration\n\n\n      if (this.props.activeModal && !prevProps.activeModal) {\n        var _this$props$document$, _this$props$document;\n\n        this.restoreFocusTo = (_this$props$document$ = (_this$props$document = this.props.document) === null || _this$props$document === void 0 ? void 0 : _this$props$document.activeElement) !== null && _this$props$document$ !== void 0 ? _this$props$document$ : undefined;\n      }\n\n      if (!this.props.activeModal && !this.props.exitingModal && this.restoreFocusTo) {\n        this.restoreFocusTo.focus();\n        this.restoreFocusTo = undefined;\n      }\n    }\n  }, {\n    key: \"openModal\",\n    value: function openModal(prevProps) {\n      var _this2 = this;\n\n      var enteringModal = this.props.enteringModal;\n\n      if (!enteringModal) {\n        return;\n      }\n\n      var enteringState = this.getModalState(enteringModal);\n      this.props.onEnter(); // Анимация открытия модального окна\n\n      if (!prevProps.exitingModal) {\n        requestAnimationFrame(function () {\n          if (_this2.props.enteringModal === enteringModal) {\n            _this2.waitTransitionFinish(enteringState, function () {\n              return _this2.props.onEntered(enteringModal);\n            });\n\n            _this2.animateModalOpacity(enteringState, true);\n          }\n        });\n        return;\n      } // Переход между модальными окнами без анимации\n\n\n      if (enteringState !== null && enteringState !== void 0 && enteringState.innerElement) {\n        enteringState.innerElement.style.transition = 'none';\n        enteringState.innerElement.style.opacity = '1';\n      }\n\n      this.props.onEntered(enteringModal);\n    }\n  }, {\n    key: \"closeModal\",\n    value: function closeModal(id) {\n      var _this3 = this;\n\n      var prevModalState = this.getModalState(id);\n\n      if (!prevModalState) {\n        return;\n      } // Анимация закрытия модального окна\n\n\n      if (!this.props.activeModal) {\n        requestAnimationFrame(function () {\n          _this3.waitTransitionFinish(prevModalState, function () {\n            return _this3.props.onExited(id);\n          });\n\n          _this3.animateModalOpacity(prevModalState, false);\n\n          _this3.setMaskOpacity(prevModalState, 0);\n        });\n        return;\n      } // Переход между модальными окнами без анимации\n\n\n      this.props.onExited(id);\n    }\n  }, {\n    key: \"waitTransitionFinish\",\n    value: function waitTransitionFinish(modalState, eventHandler) {\n      if (transitionEvent.supported) {\n        var _modalState$innerElem2;\n\n        var onceHandler = function onceHandler() {\n          var _modalState$innerElem;\n\n          modalState === null || modalState === void 0 ? void 0 : (_modalState$innerElem = modalState.innerElement) === null || _modalState$innerElem === void 0 ? void 0 : _modalState$innerElem.removeEventListener(transitionEvent.name, onceHandler);\n          eventHandler();\n        };\n\n        modalState === null || modalState === void 0 ? void 0 : (_modalState$innerElem2 = modalState.innerElement) === null || _modalState$innerElem2 === void 0 ? void 0 : _modalState$innerElem2.addEventListener(transitionEvent.name, onceHandler);\n      } else {\n        setTimeout(eventHandler, this.timeout);\n      }\n    }\n    /* Анимирует сдвиг модалки */\n\n  }, {\n    key: \"animateModalOpacity\",\n    value: function animateModalOpacity(modalState, display) {\n      if (modalState !== null && modalState !== void 0 && modalState.innerElement) {\n        modalState.innerElement.style.transition = '';\n        modalState.innerElement.style.transitionDelay = display && this.props.delayEnter ? \"\".concat(this.timeout, \"ms\") : '';\n        modalState.innerElement.style.opacity = display ? '1' : '0';\n      }\n    }\n    /* Устанавливает прозрачность для полупрозрачной подложки */\n\n  }, {\n    key: \"setMaskOpacity\",\n    value: function setMaskOpacity(modalState) {\n      var _this$props$history,\n          _this4 = this;\n\n      var forceOpacity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      if (forceOpacity === null && ((_this$props$history = this.props.history) === null || _this$props$history === void 0 ? void 0 : _this$props$history[0]) !== modalState.id) {\n        return;\n      }\n\n      if (this.maskAnimationFrame) {\n        cancelAnimationFrame(this.maskAnimationFrame);\n      }\n\n      this.maskAnimationFrame = requestAnimationFrame(function () {\n        if (_this4.maskElementRef.current) {\n          var _modalState$translate = modalState.translateY,\n              translateY = _modalState$translate === void 0 ? 0 : _modalState$translate,\n              _modalState$translate2 = modalState.translateYCurrent,\n              translateYCurrent = _modalState$translate2 === void 0 ? 0 : _modalState$translate2;\n          var opacity = forceOpacity === null ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0 : forceOpacity;\n          _this4.maskElementRef.current.style.opacity = clamp(opacity, 0, 100).toString();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props$configPro,\n          _this5 = this;\n\n      var _this$props = this.props,\n          exitingModal = _this$props.exitingModal,\n          activeModal = _this$props.activeModal;\n\n      if (!activeModal && !exitingModal) {\n        return null;\n      }\n\n      return /*#__PURE__*/React.createElement(ModalRootContext.Provider, {\n        value: this.modalRootContext\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: classNames(\"vkuiModalRoot\", ((_this$props$configPro = this.props.configProvider) === null || _this$props$configPro === void 0 ? void 0 : _this$props$configPro.webviewType) === WebviewType.VKAPPS && \"vkuiModalRoot--vkapps\", \"vkuiModalRoot--desktop\")\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"vkuiModalRoot__mask\",\n        ref: this.maskElementRef,\n        onClick: this.props.onExit\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"vkuiModalRoot__viewport\"\n      }, this.modals.map(function (Modal) {\n        var modalId = getNavId(Modal.props, warn);\n\n        if (modalId !== activeModal && modalId !== exitingModal) {\n          return null;\n        }\n\n        var key = \"modal-\".concat(modalId);\n        return /*#__PURE__*/React.createElement(FocusTrap, {\n          restoreFocus: false,\n          onClose: _this5.props.onExit,\n          timeout: _this5.timeout,\n          key: key,\n          className: \"vkuiModalRoot__modal\"\n        }, Modal);\n      }))));\n    }\n  }]);\n\n  return ModalRootDesktopComponent;\n}(React.Component);\n\nexport var ModalRootDesktop = withContext(withPlatform(withDOM(withModalManager()(ModalRootDesktopComponent))), ConfigProviderContext, 'configProvider');","map":{"version":3,"mappings":"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","names":["React","classNames","transitionEvent","withPlatform","withContext","ModalRootContext","ConfigProviderContext","WebviewType","Platform","withDOM","getNavId","warnOnce","FocusTrap","withModalManager","clamp","warn","ModalRootDesktopComponent","_inherits","props","_classCallCheck","_this","_defineProperty","undefined","maskElementRef","createRef","modalRootContext","updateModalHeight","registerModal","id","data","Object","assign","getModalState","_this$getModalState","onClose","onExit","isInsideModal","_createClass","key","get","platform","IOS","Children","toArray","children","value","prevProps","exitingModal","closeModal","enteringModal","openModal","activeModal","restoreFocusTo","document","_this$props$document","activeElement","_this$props$document$","focus","enteringState","onEnter","requestAnimationFrame","_this2","waitTransitionFinish","onEntered","animateModalOpacity","innerElement","style","transition","opacity","prevModalState","_this3","onExited","setMaskOpacity","modalState","eventHandler","supported","onceHandler","_modalState$innerElem","removeEventListener","name","_modalState$innerElem2","addEventListener","setTimeout","timeout","display","transitionDelay","delayEnter","forceOpacity","history","_this$props$history","maskAnimationFrame","cancelAnimationFrame","_this4","current","translateY","_modalState$translate","_modalState$translate2","translateYCurrent","toString","Provider","className","configProvider","_this$props$configPro","webviewType","VKAPPS","ref","onClick","modals","map","Modal","modalId","restoreFocus","_this5","Component","ModalRootDesktop"],"sources":["/Users/pitus_anonimous/Desktop/youth_bit_hack/youth_bit_vk/node_modules/@vkontakte/vkui/src/components/ModalRoot/ModalRootDesktop.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withContext } from '../../hoc/withContext';\nimport { ModalRootContext, ModalRootContextInterface } from './ModalRootContext';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  WebviewType,\n} from '../ConfigProvider/ConfigProviderContext';\nimport { ModalsStateEntry } from './types';\nimport { Platform } from '../../lib/platform';\nimport { DOMProps, withDOM } from '../../lib/dom';\nimport { getNavId } from '../../lib/getNavId';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { ModalTransitionProps, withModalManager } from './useModalManager';\nimport { clamp } from '../../helpers/math';\nimport styles from './ModalRoot.module.css';\n\nconst warn = warnOnce('ModalRoot');\n\nexport interface ModalRootProps extends HasPlatform {\n  activeModal?: string | null;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  children?: React.ReactNode;\n\n  /**\n   * Будет вызвано при начале открытия активной модалки с её id\n   */\n  onOpen?(modalId: string): void;\n\n  /**\n   * Будет вызвано при окончательном открытии активной модалки с её id\n   */\n  onOpened?(modalId: string): void;\n\n  /**\n   * Будет вызвано при начале закрытия активной модалки с её id\n   */\n  onClose?(modalId: string): void;\n\n  /**\n   * Будет вызвано при окончательном закрытии активной модалки с её id\n   */\n  onClosed?(modalId: string): void;\n}\n\nclass ModalRootDesktopComponent extends React.Component<\n  ModalRootProps & DOMProps & ModalTransitionProps\n> {\n  constructor(props: ModalRootProps & ModalTransitionProps) {\n    super(props);\n\n    this.maskElementRef = React.createRef();\n\n    this.modalRootContext = {\n      updateModalHeight: () => undefined,\n      registerModal: ({ id, ...data }) => Object.assign(this.getModalState(id) ?? {}, data),\n      onClose: () => this.props.onExit(),\n      isInsideModal: true,\n    };\n  }\n\n  private readonly maskElementRef: React.RefObject<HTMLDivElement>;\n  private maskAnimationFrame: number | undefined = undefined;\n  private readonly modalRootContext: ModalRootContextInterface;\n  private restoreFocusTo: HTMLElement | undefined = undefined;\n\n  private get timeout() {\n    return this.props.platform === Platform.IOS ? 400 : 320;\n  }\n\n  private get modals() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  getModalState(id: string | null) {\n    if (id === null) {\n      return undefined;\n    }\n    return this.props.getModalState(id);\n  }\n\n  componentDidUpdate(prevProps: ModalRootProps & ModalTransitionProps) {\n    // transition phase 2: animate exiting modal\n    if (this.props.exitingModal && this.props.exitingModal !== prevProps.exitingModal) {\n      this.closeModal(this.props.exitingModal);\n    }\n\n    // transition phase 3: animate entering modal\n    if (this.props.enteringModal && this.props.enteringModal !== prevProps.enteringModal) {\n      this.openModal(prevProps);\n    }\n\n    // focus restoration\n    if (this.props.activeModal && !prevProps.activeModal) {\n      this.restoreFocusTo = (this.props.document?.activeElement ?? undefined) as\n        | HTMLElement\n        | undefined;\n    }\n    if (!this.props.activeModal && !this.props.exitingModal && this.restoreFocusTo) {\n      this.restoreFocusTo.focus();\n      this.restoreFocusTo = undefined;\n    }\n  }\n\n  openModal(prevProps: ModalRootProps & ModalTransitionProps) {\n    const { enteringModal } = this.props;\n    if (!enteringModal) {\n      return;\n    }\n\n    const enteringState = this.getModalState(enteringModal);\n    this.props.onEnter();\n\n    // Анимация открытия модального окна\n    if (!prevProps.exitingModal) {\n      requestAnimationFrame(() => {\n        if (this.props.enteringModal === enteringModal) {\n          this.waitTransitionFinish(enteringState, () => this.props.onEntered(enteringModal));\n          this.animateModalOpacity(enteringState, true);\n        }\n      });\n\n      return;\n    }\n\n    // Переход между модальными окнами без анимации\n    if (enteringState?.innerElement) {\n      enteringState.innerElement.style.transition = 'none';\n      enteringState.innerElement.style.opacity = '1';\n    }\n\n    this.props.onEntered(enteringModal);\n  }\n\n  closeModal(id: string) {\n    const prevModalState = this.getModalState(id);\n    if (!prevModalState) {\n      return;\n    }\n\n    // Анимация закрытия модального окна\n    if (!this.props.activeModal) {\n      requestAnimationFrame(() => {\n        this.waitTransitionFinish(prevModalState, () => this.props.onExited(id));\n        this.animateModalOpacity(prevModalState, false);\n        this.setMaskOpacity(prevModalState, 0);\n      });\n\n      return;\n    }\n\n    // Переход между модальными окнами без анимации\n    this.props.onExited(id);\n  }\n\n  waitTransitionFinish(modalState: ModalsStateEntry | undefined, eventHandler: () => void) {\n    if (transitionEvent.supported) {\n      const onceHandler = () => {\n        modalState?.innerElement?.removeEventListener(transitionEvent.name as string, onceHandler);\n        eventHandler();\n      };\n\n      modalState?.innerElement?.addEventListener(transitionEvent.name as string, onceHandler);\n    } else {\n      setTimeout(eventHandler, this.timeout);\n    }\n  }\n\n  /* Анимирует сдвиг модалки */\n  animateModalOpacity(modalState: ModalsStateEntry | undefined, display: boolean) {\n    if (modalState?.innerElement) {\n      modalState.innerElement.style.transition = '';\n      modalState.innerElement.style.transitionDelay =\n        display && this.props.delayEnter ? `${this.timeout}ms` : '';\n      modalState.innerElement.style.opacity = display ? '1' : '0';\n    }\n  }\n\n  /* Устанавливает прозрачность для полупрозрачной подложки */\n  setMaskOpacity(modalState: ModalsStateEntry, forceOpacity: number | null = null) {\n    if (forceOpacity === null && this.props.history?.[0] !== modalState.id) {\n      return;\n    }\n\n    if (this.maskAnimationFrame) {\n      cancelAnimationFrame(this.maskAnimationFrame);\n    }\n    this.maskAnimationFrame = requestAnimationFrame(() => {\n      if (this.maskElementRef.current) {\n        const { translateY = 0, translateYCurrent = 0 } = modalState;\n\n        const opacity =\n          forceOpacity === null\n            ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0\n            : forceOpacity;\n        this.maskElementRef.current.style.opacity = clamp(opacity, 0, 100).toString();\n      }\n    });\n  }\n\n  render() {\n    const { exitingModal, activeModal } = this.props;\n\n    if (!activeModal && !exitingModal) {\n      return null;\n    }\n\n    return (\n      <ModalRootContext.Provider value={this.modalRootContext}>\n        <div\n          className={classNames(\n            styles['ModalRoot'],\n            this.props.configProvider?.webviewType === WebviewType.VKAPPS &&\n              styles['ModalRoot--vkapps'],\n            styles['ModalRoot--desktop'],\n          )}\n        >\n          <div\n            className={styles['ModalRoot__mask']}\n            ref={this.maskElementRef}\n            onClick={this.props.onExit}\n          />\n          <div className={styles['ModalRoot__viewport']}>\n            {this.modals.map((Modal: React.ReactElement) => {\n              const modalId = getNavId(Modal.props, warn);\n              if (modalId !== activeModal && modalId !== exitingModal) {\n                return null;\n              }\n\n              const key = `modal-${modalId}`;\n\n              return (\n                <FocusTrap\n                  restoreFocus={false}\n                  onClose={this.props.onExit}\n                  timeout={this.timeout}\n                  key={key}\n                  className={styles['ModalRoot__modal']}\n                >\n                  {Modal}\n                </FocusTrap>\n              );\n            })}\n          </div>\n        </div>\n      </ModalRootContext.Provider>\n    );\n  }\n}\n\nexport const ModalRootDesktop = withContext(\n  withPlatform(withDOM<ModalRootProps>(withModalManager()(ModalRootDesktopComponent))),\n  ConfigProviderContext,\n  'configProvider',\n);\n"]},"metadata":{},"sourceType":"module"}