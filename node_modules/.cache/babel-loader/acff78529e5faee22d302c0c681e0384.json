{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { clamp } from '../../helpers/math';\nimport { useDOM } from '../../lib/dom';\n\nvar clearDisableScrollStyle = function clearDisableScrollStyle(node) {\n  Object.assign(node.style, {\n    position: '',\n    top: '',\n    left: '',\n    right: '',\n    overflowY: '',\n    overflowX: ''\n  });\n};\n\nvar getPageYOffsetWithoutKeyboardHeight = function getPageYOffsetWithoutKeyboardHeight(window) {\n  // Note: здесь расчёт на то, что `clientHeight` равен `window.innerHeight`.\n  //  Это достигается тем, что тегу `html` задали`height: 100%` и у него нет отступов сверху и снизу. Если есть отступы,\n  //  то надо задать `box-sizing: border-box`, чтобы они не учитывались.\n  var diffOfClientHeightAndViewportHeight = window.document.documentElement.clientHeight - window.innerHeight;\n  return window.pageYOffset - diffOfClientHeightAndViewportHeight;\n};\n\nexport var ScrollContext = /*#__PURE__*/React.createContext({\n  getScroll: function getScroll() {\n    return {\n      x: 0,\n      y: 0\n    };\n  },\n  scrollTo: noop,\n  isScrollLock: false,\n  enableScrollLock: noop,\n  disableScrollLock: noop\n});\nexport var useScroll = function useScroll() {\n  return React.useContext(ScrollContext);\n};\nexport var GlobalScrollController = function GlobalScrollController(_ref) {\n  var children = _ref.children;\n\n  var _useDOM = useDOM(),\n      window = _useDOM.window,\n      document = _useDOM.document;\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isScrollLock = _React$useState2[0],\n      setScrollLock = _React$useState2[1];\n\n  var beforeScrollLockFnSetRef = React.useRef(new Set());\n  var getScroll = React.useCallback(function () {\n    return {\n      x: window.pageXOffset,\n      y: getPageYOffsetWithoutKeyboardHeight(window)\n    };\n  }, [window]);\n  var scrollTo = React.useCallback(function () {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0; // Some iOS versions do not normalize scroll — do it manually.\n\n    window.scrollTo(x ? clamp(x, 0, document.body.scrollWidth - window.innerWidth) : 0, y ? clamp(y, 0, document.body.scrollHeight - window.innerHeight) : 0);\n  }, [document, window]);\n  var enableScrollLock = React.useCallback(function () {\n    beforeScrollLockFnSetRef.current.forEach(function (fn) {\n      fn();\n    });\n    var scrollY = window.pageYOffset;\n    var scrollX = window.pageXOffset;\n    var overflowY = window.innerWidth > document.documentElement.clientWidth ? 'scroll' : '';\n    var overflowX = window.innerHeight > document.documentElement.clientHeight ? 'scroll' : '';\n    Object.assign(document.body.style, {\n      position: 'fixed',\n      top: \"-\".concat(scrollY, \"px\"),\n      left: \"-\".concat(scrollX, \"px\"),\n      right: '0',\n      overflowY: overflowY,\n      overflowX: overflowX\n    });\n    setScrollLock(true);\n  }, [document, window]);\n  var disableScrollLock = React.useCallback(function () {\n    var scrollY = document.body.style.top;\n    var scrollX = document.body.style.left;\n    clearDisableScrollStyle(document.body);\n    window.scrollTo(-parseInt(scrollX || '0'), -parseInt(scrollY || '0'));\n    setScrollLock(false);\n  }, [document, window]);\n  var scrollController = React.useMemo(function () {\n    return {\n      getScroll: getScroll,\n      scrollTo: scrollTo,\n      isScrollLock: isScrollLock,\n      disableScrollLock: disableScrollLock,\n      enableScrollLock: enableScrollLock,\n      beforeScrollLockFnSetRef: beforeScrollLockFnSetRef\n    };\n  }, [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock]);\n  return /*#__PURE__*/React.createElement(ScrollContext.Provider, {\n    value: scrollController\n  }, children);\n};\nexport var ElementScrollController = function ElementScrollController(_ref2) {\n  var elRef = _ref2.elRef,\n      children = _ref2.children;\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      isScrollLock = _React$useState4[0],\n      setScrollLock = _React$useState4[1];\n\n  var beforeScrollLockFnSetRef = React.useRef(new Set());\n  var getScroll = React.useCallback(function () {\n    var _elRef$current$scroll, _elRef$current, _elRef$current$scroll2, _elRef$current2;\n\n    return {\n      x: (_elRef$current$scroll = (_elRef$current = elRef.current) === null || _elRef$current === void 0 ? void 0 : _elRef$current.scrollLeft) !== null && _elRef$current$scroll !== void 0 ? _elRef$current$scroll : 0,\n      y: (_elRef$current$scroll2 = (_elRef$current2 = elRef.current) === null || _elRef$current2 === void 0 ? void 0 : _elRef$current2.scrollTop) !== null && _elRef$current$scroll2 !== void 0 ? _elRef$current$scroll2 : 0\n    };\n  }, [elRef]);\n  var scrollTo = React.useCallback(function () {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    var el = elRef.current; // Some iOS versions do not normalize scroll — do it manually.\n\n    el === null || el === void 0 ? void 0 : el.scrollTo(x ? clamp(x, 0, el.scrollWidth - el.clientWidth) : 0, y ? clamp(y, 0, el.scrollHeight - el.clientHeight) : 0);\n  }, [elRef]);\n  var enableScrollLock = React.useCallback(function () {\n    var el = elRef.current;\n\n    if (!el) {\n      return;\n    }\n\n    beforeScrollLockFnSetRef.current.forEach(function (fn) {\n      fn();\n    });\n    var scrollY = el.scrollTop;\n    var scrollX = el.scrollLeft;\n    var overflowY = el.scrollWidth > el.clientWidth ? 'scroll' : '';\n    var overflowX = el.scrollHeight > el.clientHeight ? 'scroll' : '';\n    Object.assign(el.style, {\n      position: 'absolute',\n      top: \"-\".concat(scrollY, \"px\"),\n      left: \"-\".concat(scrollX, \"px\"),\n      right: '0',\n      overflowY: overflowY,\n      overflowX: overflowX\n    });\n    setScrollLock(true);\n  }, [elRef]);\n  var disableScrollLock = React.useCallback(function () {\n    var el = elRef.current;\n\n    if (!el) {\n      return;\n    }\n\n    var scrollY = el.style.top;\n    var scrollX = el.style.left;\n    clearDisableScrollStyle(el);\n    el.scrollTo(-parseInt(scrollX || '0'), -parseInt(scrollY || '0'));\n    setScrollLock(false);\n  }, [elRef]);\n  var scrollController = React.useMemo(function () {\n    return {\n      getScroll: getScroll,\n      scrollTo: scrollTo,\n      isScrollLock: isScrollLock,\n      disableScrollLock: disableScrollLock,\n      enableScrollLock: enableScrollLock,\n      beforeScrollLockFnSetRef: beforeScrollLockFnSetRef\n    };\n  }, [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock]);\n  return /*#__PURE__*/React.createElement(ScrollContext.Provider, {\n    value: scrollController\n  }, children);\n};\n/**\n * Вызывает функцию effect, до блокировки прокрутки\n * @param effect функция, которая может возвращать функцию очистки\n * @param deps effect обновится только при изменении значений в списке.\n */\n\nexport var useScrollLockEffect = function useScrollLockEffect(effect, deps) {\n  var destructorRef = React.useRef(noop);\n\n  var _useScroll = useScroll(),\n      isScrollLock = _useScroll.isScrollLock,\n      beforeScrollLockFnSetRef = _useScroll.beforeScrollLockFnSetRef; // Изменяем effectCallback только при изменении deps\n\n\n  var effectCallback = React.useCallback(function () {\n    destructorRef.current = effect(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps); // Добавляем effectCallback в список функций, которые необходимо вызвать\n  // до блокировки\n\n  React.useEffect(function () {\n    var beforeSet = beforeScrollLockFnSetRef === null || beforeScrollLockFnSetRef === void 0 ? void 0 : beforeScrollLockFnSetRef.current;\n\n    if (!beforeSet) {\n      return noop;\n    }\n\n    beforeSet.add(effectCallback);\n    return function () {\n      beforeSet.delete(effectCallback);\n    };\n  }, [beforeScrollLockFnSetRef, effectCallback]); // Вызываем сбрасывающую функцию, после отключения блокировки\n\n  React.useEffect(function () {\n    if (!isScrollLock && destructorRef.current) {\n      destructorRef.current();\n    }\n  }, [isScrollLock]);\n};\nexport var useScrollLock = function useScrollLock() {\n  var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n  var _useScroll2 = useScroll(),\n      enableScrollLock = _useScroll2.enableScrollLock,\n      disableScrollLock = _useScroll2.disableScrollLock;\n\n  useIsomorphicLayoutEffect(function () {\n    if (enabled) {\n      enableScrollLock();\n      return disableScrollLock;\n    }\n\n    return noop;\n  }, [enableScrollLock, disableScrollLock, enabled]);\n};","map":{"version":3,"mappings":"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","names":["React","noop","useIsomorphicLayoutEffect","clamp","useDOM","clearDisableScrollStyle","node","Object","assign","style","position","top","left","right","overflowY","overflowX","getPageYOffsetWithoutKeyboardHeight","window","diffOfClientHeightAndViewportHeight","document","documentElement","clientHeight","innerHeight","pageYOffset","ScrollContext","createContext","getScroll","x","y","scrollTo","isScrollLock","enableScrollLock","disableScrollLock","useScroll","useContext","GlobalScrollController","_ref","children","useState","_React$useState2","setScrollLock","beforeScrollLockFnSetRef","useRef","Set","useCallback","pageXOffset","body","scrollWidth","innerWidth","scrollHeight","current","forEach","fn","scrollY","scrollX","clientWidth","parseInt","scrollController","useMemo","Provider","value","ElementScrollController","_ref2","elRef","_React$useState4","_elRef$current","scrollLeft","_elRef$current$scroll","_elRef$current2","scrollTop","_elRef$current$scroll2","el","useScrollLockEffect","effect","deps","destructorRef","effectCallback","useEffect","beforeSet","add","delete","useScrollLock","enabled"],"sources":["/Users/pitus_anonimous/Desktop/youth_bit_hack/youth_bit_vk/node_modules/@vkontakte/vkui/src/components/AppRoot/ScrollContext.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { clamp } from '../../helpers/math';\nimport { useDOM } from '../../lib/dom';\n\nconst clearDisableScrollStyle = (node: HTMLElement) => {\n  Object.assign(node.style, {\n    position: '',\n    top: '',\n    left: '',\n    right: '',\n    overflowY: '',\n    overflowX: '',\n  });\n};\n\nconst getPageYOffsetWithoutKeyboardHeight = (window: Window) => {\n  // Note: здесь расчёт на то, что `clientHeight` равен `window.innerHeight`.\n  //  Это достигается тем, что тегу `html` задали`height: 100%` и у него нет отступов сверху и снизу. Если есть отступы,\n  //  то надо задать `box-sizing: border-box`, чтобы они не учитывались.\n  const diffOfClientHeightAndViewportHeight =\n    window.document.documentElement.clientHeight - window.innerHeight;\n  return window.pageYOffset - diffOfClientHeightAndViewportHeight;\n};\n\nexport interface ScrollContextInterface {\n  getScroll(this: void): { x: number; y: number };\n  scrollTo(this: void, x?: number, y?: number): void;\n  isScrollLock: boolean;\n  enableScrollLock(this: void): void;\n  disableScrollLock(this: void): void;\n  beforeScrollLockFnSetRef?: React.RefObject<Set<() => void>>;\n}\n\nexport const ScrollContext = React.createContext<ScrollContextInterface>({\n  getScroll: () => ({ x: 0, y: 0 }),\n  scrollTo: noop,\n  isScrollLock: false,\n  enableScrollLock: noop,\n  disableScrollLock: noop,\n});\n\nexport const useScroll = () => React.useContext(ScrollContext);\n\nexport interface ScrollControllerProps {\n  elRef: React.RefObject<HTMLElement>;\n  children?: React.ReactNode;\n}\n\nexport const GlobalScrollController = ({ children }: ScrollControllerProps) => {\n  const { window, document } = useDOM();\n  const [isScrollLock, setScrollLock] = React.useState(false);\n  const beforeScrollLockFnSetRef = React.useRef<Set<() => void>>(new Set());\n\n  const getScroll = React.useCallback<ScrollContextInterface['getScroll']>(\n    () => ({\n      x: window!.pageXOffset,\n      y: getPageYOffsetWithoutKeyboardHeight(window!),\n    }),\n    [window],\n  );\n  const scrollTo = React.useCallback<ScrollContextInterface['scrollTo']>(\n    (x = 0, y = 0) => {\n      // Some iOS versions do not normalize scroll — do it manually.\n      window!.scrollTo(\n        x ? clamp(x, 0, document!.body.scrollWidth - window!.innerWidth) : 0,\n        y ? clamp(y, 0, document!.body.scrollHeight - window!.innerHeight) : 0,\n      );\n    },\n    [document, window],\n  );\n\n  const enableScrollLock = React.useCallback<ScrollContextInterface['enableScrollLock']>(() => {\n    beforeScrollLockFnSetRef.current.forEach((fn) => {\n      fn();\n    });\n\n    const scrollY = window!.pageYOffset;\n    const scrollX = window!.pageXOffset;\n    const overflowY = window!.innerWidth > document!.documentElement.clientWidth ? 'scroll' : '';\n    const overflowX = window!.innerHeight > document!.documentElement.clientHeight ? 'scroll' : '';\n\n    Object.assign(document!.body.style, {\n      position: 'fixed',\n      top: `-${scrollY}px`,\n      left: `-${scrollX}px`,\n      right: '0',\n      overflowY,\n      overflowX,\n    });\n    setScrollLock(true);\n  }, [document, window]);\n\n  const disableScrollLock = React.useCallback<ScrollContextInterface['disableScrollLock']>(() => {\n    const scrollY = document!.body.style.top;\n    const scrollX = document!.body.style.left;\n\n    clearDisableScrollStyle(document!.body);\n    window!.scrollTo(-parseInt(scrollX || '0'), -parseInt(scrollY || '0'));\n    setScrollLock(false);\n  }, [document, window]);\n\n  const scrollController = React.useMemo<ScrollContextInterface>(\n    () => ({\n      getScroll,\n      scrollTo,\n      isScrollLock,\n      disableScrollLock,\n      enableScrollLock,\n\n      beforeScrollLockFnSetRef: beforeScrollLockFnSetRef,\n    }),\n    [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock],\n  );\n\n  return <ScrollContext.Provider value={scrollController}>{children}</ScrollContext.Provider>;\n};\n\nexport const ElementScrollController = ({ elRef, children }: ScrollControllerProps) => {\n  const [isScrollLock, setScrollLock] = React.useState(false);\n  const beforeScrollLockFnSetRef = React.useRef<Set<() => void>>(new Set());\n\n  const getScroll = React.useCallback<ScrollContextInterface['getScroll']>(\n    () => ({\n      x: elRef.current?.scrollLeft ?? 0,\n      y: elRef.current?.scrollTop ?? 0,\n    }),\n    [elRef],\n  );\n  const scrollTo = React.useCallback<ScrollContextInterface['scrollTo']>(\n    (x = 0, y = 0) => {\n      const el = elRef.current;\n      // Some iOS versions do not normalize scroll — do it manually.\n      el?.scrollTo(\n        x ? clamp(x, 0, el.scrollWidth - el.clientWidth) : 0,\n        y ? clamp(y, 0, el.scrollHeight - el.clientHeight) : 0,\n      );\n    },\n    [elRef],\n  );\n\n  const enableScrollLock = React.useCallback<ScrollContextInterface['enableScrollLock']>(() => {\n    const el = elRef.current;\n    if (!el) {\n      return;\n    }\n    beforeScrollLockFnSetRef.current.forEach((fn) => {\n      fn();\n    });\n\n    const scrollY = el.scrollTop;\n    const scrollX = el.scrollLeft;\n    const overflowY = el.scrollWidth > el.clientWidth ? 'scroll' : '';\n    const overflowX = el.scrollHeight > el.clientHeight ? 'scroll' : '';\n\n    Object.assign(el.style, {\n      position: 'absolute',\n      top: `-${scrollY}px`,\n      left: `-${scrollX}px`,\n      right: '0',\n      overflowY,\n      overflowX,\n    });\n    setScrollLock(true);\n  }, [elRef]);\n\n  const disableScrollLock = React.useCallback<ScrollContextInterface['disableScrollLock']>(() => {\n    const el = elRef.current;\n    if (!el) {\n      return;\n    }\n\n    const scrollY = el.style.top;\n    const scrollX = el.style.left;\n\n    clearDisableScrollStyle(el);\n    el.scrollTo(-parseInt(scrollX || '0'), -parseInt(scrollY || '0'));\n    setScrollLock(false);\n  }, [elRef]);\n\n  const scrollController = React.useMemo<ScrollContextInterface>(\n    () => ({\n      getScroll,\n      scrollTo,\n      isScrollLock,\n      disableScrollLock,\n      enableScrollLock,\n      beforeScrollLockFnSetRef,\n    }),\n    [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock],\n  );\n\n  return <ScrollContext.Provider value={scrollController}>{children}</ScrollContext.Provider>;\n};\n\n/**\n * Вызывает функцию effect, до блокировки прокрутки\n * @param effect функция, которая может возвращать функцию очистки\n * @param deps effect обновится только при изменении значений в списке.\n */\nexport const useScrollLockEffect = (effect: React.EffectCallback, deps: React.DependencyList) => {\n  const destructorRef = React.useRef<ReturnType<React.EffectCallback>>(noop);\n  const { isScrollLock, beforeScrollLockFnSetRef } = useScroll();\n\n  // Изменяем effectCallback только при изменении deps\n  const effectCallback = React.useCallback(() => {\n    destructorRef.current = effect();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n\n  // Добавляем effectCallback в список функций, которые необходимо вызвать\n  // до блокировки\n  React.useEffect(() => {\n    const beforeSet = beforeScrollLockFnSetRef?.current;\n    if (!beforeSet) {\n      return noop;\n    }\n\n    beforeSet.add(effectCallback);\n\n    return () => {\n      beforeSet.delete(effectCallback);\n    };\n  }, [beforeScrollLockFnSetRef, effectCallback]);\n\n  // Вызываем сбрасывающую функцию, после отключения блокировки\n  React.useEffect(() => {\n    if (!isScrollLock && destructorRef.current) {\n      destructorRef.current();\n    }\n  }, [isScrollLock]);\n};\n\nexport const useScrollLock = (enabled = true) => {\n  const { enableScrollLock, disableScrollLock } = useScroll();\n  useIsomorphicLayoutEffect(() => {\n    if (enabled) {\n      enableScrollLock();\n      return disableScrollLock;\n    }\n    return noop;\n  }, [enableScrollLock, disableScrollLock, enabled]);\n};\n"]},"metadata":{},"sourceType":"module"}