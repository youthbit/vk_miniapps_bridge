{"version":3,"file":"AppRoot.js","names":["React","useDOM","classNames","noop","AppRootContext","useIsomorphicLayoutEffect","IconSettingsProvider","ElementScrollController","GlobalScrollController","useKeyboardInputTracker","useInsets","useAdaptivity","useAppearance","isRefObject","getSizeXClassName","INSET_CUSTOM_PROPERTY_PREFIX","AppRoot","children","mode","scroll","portalRoot","portalRootProp","disablePortal","className","props","isKeyboardInputActive","rootRef","useRef","useState","setPortalRoot","document","insets","appearance","hasPointer","sizeX","portal","current","createElement","body","appendChild","parentElement","removeChild","parent","classList","add","remove","documentElement","undefined","key","hasOwnProperty","inset","style","setProperty","removeProperty","container","ScrollController","useMemo","content","appRoot","embedded","keyboardInput"],"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { AppRootContext } from './AppRootContext';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { ElementScrollController, GlobalScrollController } from './ScrollContext';\nimport { useKeyboardInputTracker } from '../../hooks/useKeyboardInputTracker';\nimport { useInsets } from '../../hooks/useInsets';\nimport { Insets } from '@vkontakte/vk-bridge';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAppearance } from '../../hooks/useAppearance';\nimport { isRefObject } from '../../lib/isRefObject';\nimport { getSizeXClassName } from '../../helpers/getSizeXClassName';\nimport styles from './AppRoot.module.css';\n\nconst INSET_CUSTOM_PROPERTY_PREFIX = `--vkui_internal--safe_area_inset_`;\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends React.HTMLAttributes<HTMLDivElement> {\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  scroll?: 'global' | 'contain';\n  /**\n   * Кастомный root-элемент портала\n   */\n  portalRoot?: HTMLElement | React.RefObject<HTMLElement> | null;\n  /** Disable portal for components */\n  disablePortal?: boolean;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\nexport const AppRoot = ({\n  children,\n  mode = 'full',\n  scroll = 'global',\n  portalRoot: portalRootProp = null,\n  disablePortal,\n  className,\n  ...props\n}: AppRootProps) => {\n  const isKeyboardInputActive = useKeyboardInputTracker();\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [portalRoot, setPortalRoot] = React.useState<HTMLElement | null>(null);\n  const { document } = useDOM();\n  const insets = useInsets();\n  const appearance = useAppearance();\n\n  const { hasPointer, sizeX } = useAdaptivity();\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    let portal: HTMLElement | null = null;\n    if (portalRootProp) {\n      if (isRefObject(portalRootProp)) {\n        portal = portalRootProp.current;\n      } else {\n        portal = portalRootProp;\n      }\n    }\n    if (!portal) {\n      portal = document!.createElement('div');\n      document!.body.appendChild(portal);\n    }\n    setPortalRoot(portal);\n    return () => {\n      portal?.parentElement?.removeChild(portal);\n    };\n  }, [portalRootProp]);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode !== 'embedded') {\n      return noop;\n    }\n\n    const parent = rootRef.current?.parentElement;\n    parent?.classList.add('vkui__root--embedded');\n\n    return () => {\n      parent?.classList.remove('vkui__root--embedded');\n    };\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      document!.documentElement.classList.add('vkui');\n\n      return () => {\n        document!.documentElement.classList.remove('vkui');\n      };\n    }\n\n    return undefined;\n  }, [document, mode]);\n\n  // setup insets\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || !rootRef.current?.parentElement) {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n\n    let key: keyof Insets;\n    for (key in insets) {\n      if (insets.hasOwnProperty(key) && typeof insets[key] === 'number') {\n        const inset = insets[key];\n        parent.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n        portalRoot &&\n          portalRoot.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n      }\n    }\n\n    return () => {\n      let key: keyof Insets;\n      for (key in insets) {\n        if (insets.hasOwnProperty(key)) {\n          parent.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n          portalRoot && portalRoot.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n        }\n      }\n    };\n  }, [insets, portalRoot]);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n    const className = getSizeXClassName('vkui', sizeX);\n    const container = mode === 'embedded' ? rootRef.current?.parentElement : document!.body;\n    container?.classList.add(className);\n    return () => container?.classList.remove(className);\n  }, [sizeX]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode !== 'full' || appearance === undefined) {\n      return noop;\n    }\n    document!.documentElement.style.setProperty('color-scheme', appearance);\n\n    return () => document!.documentElement.style.removeProperty('color-scheme');\n  }, [appearance]);\n\n  const ScrollController = React.useMemo(\n    () => (scroll === 'contain' ? ElementScrollController : GlobalScrollController),\n    [scroll],\n  );\n\n  const content = (\n    <AppRootContext.Provider\n      value={{\n        appRoot: rootRef,\n        portalRoot,\n        embedded: mode === 'embedded',\n        keyboardInput: isKeyboardInputActive,\n        mode,\n        disablePortal,\n      }}\n    >\n      <ScrollController elRef={rootRef}>\n        <IconSettingsProvider classPrefix=\"vkui\">{children}</IconSettingsProvider>\n      </ScrollController>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? (\n    content\n  ) : (\n    <div\n      ref={rootRef}\n      className={classNames(\n        styles['AppRoot'],\n        hasPointer === undefined\n          ? styles['AppRoot--pointer-none']\n          : !hasPointer && styles['AppRoot--pointer-has-not'],\n        className,\n      )}\n      {...props}\n    >\n      {content}\n    </div>\n  );\n};\n"],"mappings":"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"}