{"version":3,"file":"CustomSelectDropdown.js","names":["React","CustomScrollView","classNames","noop","Popper","Spinner","useIsomorphicLayoutEffect","calcIsTop","placement","includes","getObserverModifier","element","name","enabled","phase","fn","effect","instance","observer","MutationObserver","forceUpdate","observe","childList","subtree","disconnect","CustomSelectDropdown","children","targetRef","scrollBoxRef","fetching","parentOnPlacementChange","onPlacementChange","offsetDistance","sameWidth","forcePortal","autoHideScrollbar","autoHideScrollbarDelay","observableRefs","className","restProps","useState","isTop","setIsTop","customModifiers","setCustomModifiers","Array","isArray","ref","current","push","useCallback"],"sources":["../../../../src/components/CustomSelectDropdown/CustomSelectDropdown.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Modifier } from 'react-popper';\nimport { CustomScrollView } from '../CustomScrollView/CustomScrollView';\nimport { TrackerOptionsProps } from '../CustomScrollView/useTrackerVisibility';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { Popper, Placement } from '../Popper/Popper';\nimport { Spinner } from '../Spinner/Spinner';\nimport { HasRef } from '../../types';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport styles from './CustomSelectDropdown.module.css';\n\nexport interface CustomSelectDropdownProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasRef<HTMLDivElement>,\n    TrackerOptionsProps {\n  targetRef: React.RefObject<HTMLElement>;\n  placement?: Placement;\n  scrollBoxRef?: React.Ref<HTMLDivElement>;\n  observableRefs?: Array<React.RefObject<HTMLElement>> | React.RefObject<HTMLElement>;\n  fetching?: boolean;\n  offsetDistance?: number;\n  sameWidth?: boolean;\n  forcePortal?: boolean;\n  onPlacementChange?: (placement?: Placement) => void;\n}\n\nconst calcIsTop = (placement?: Placement) => placement?.includes('top');\n\nfunction getObserverModifier<T extends HTMLElement>(element: T): Modifier<string> {\n  return {\n    name: 'customSelectChildrenChange',\n    enabled: true,\n    phase: 'main',\n    fn: noop,\n    effect: ({ instance }) => {\n      const observer = new MutationObserver(instance.forceUpdate);\n\n      observer.observe(element, {\n        childList: true,\n        subtree: true,\n      });\n\n      return () => {\n        observer.disconnect();\n      };\n    },\n  };\n}\n\nexport const CustomSelectDropdown = ({\n  children,\n  targetRef,\n  scrollBoxRef,\n  placement,\n  fetching,\n  onPlacementChange: parentOnPlacementChange,\n  offsetDistance = 0,\n  sameWidth = true,\n  forcePortal = true,\n  autoHideScrollbar,\n  autoHideScrollbarDelay,\n  observableRefs,\n  className,\n  ...restProps\n}: CustomSelectDropdownProps) => {\n  const [isTop, setIsTop] = React.useState(() => calcIsTop(placement));\n  const [customModifiers, setCustomModifiers] = React.useState<Array<Modifier<string>>>([]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!observableRefs) {\n      return;\n    }\n    const customModifiers: Array<Modifier<string>> = [];\n\n    if (Array.isArray(observableRefs)) {\n      for (const ref of observableRefs) {\n        if (ref?.current) {\n          customModifiers.push(getObserverModifier(ref.current));\n        }\n      }\n    } else if (observableRefs.current) {\n      customModifiers.push(getObserverModifier(observableRefs.current));\n    }\n\n    setCustomModifiers(customModifiers);\n  }, [observableRefs]);\n\n  const onPlacementChange = React.useCallback(\n    ({ placement }: { placement?: Placement }) => {\n      setIsTop(calcIsTop(placement));\n      parentOnPlacementChange?.(placement);\n    },\n    [parentOnPlacementChange, setIsTop],\n  );\n\n  return (\n    <Popper\n      targetRef={targetRef}\n      offsetDistance={offsetDistance}\n      sameWidth={sameWidth}\n      onPlacementChange={onPlacementChange}\n      placement={placement}\n      className={classNames(\n        styles['CustomSelectDropdown'],\n        offsetDistance === 0 &&\n          (isTop ? styles['CustomSelectDropdown--top'] : styles['CustomSelectDropdown--bottom']),\n        sameWidth && styles['CustomSelectDropdown--wide'],\n        className,\n      )}\n      forcePortal={forcePortal}\n      customModifiers={customModifiers}\n      {...restProps}\n    >\n      <CustomScrollView\n        boxRef={scrollBoxRef}\n        className={styles['CustomSelectDropdown__in']}\n        autoHideScrollbar={autoHideScrollbar}\n        autoHideScrollbarDelay={autoHideScrollbarDelay}\n      >\n        {fetching ? (\n          <div className={styles['CustomSelectDropdown__fetching']}>\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          children\n        )}\n      </CustomScrollView>\n    </Popper>\n  );\n};\n"],"mappings":"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"}