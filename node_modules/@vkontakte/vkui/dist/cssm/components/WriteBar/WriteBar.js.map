{"version":3,"file":"WriteBar.js","names":["React","Headline","usePlatform","useExternRef","classNames","hasReactNode","Platform","useEnsuredControl","WriteBar","className","style","before","inlineAfter","after","getRootRef","getRef","onHeightChange","shadow","defaultValue","restProps","platform","value","onChange","textareaRef","currentScrollHeight","useRef","resize","useCallback","textareaEl","current","offsetParent","height","scrollHeight","useEffect","IOS"],"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Headline } from '../Typography/Headline/Headline';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { Platform } from '../../lib/platform';\nimport { HasRef, HasRootRef } from '../../types';\nimport { useEnsuredControl } from '../../hooks/useEnsuredControl';\nimport styles from './WriteBar.module.css';\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n  /**\n   * Добавляет тень вокруг поля ввода\n   */\n  shadow?: boolean;\n\n  children?: never;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar = ({\n  className,\n  style,\n  before,\n  inlineAfter,\n  after,\n  getRootRef,\n  getRef,\n  onHeightChange,\n  shadow = false,\n  defaultValue,\n  ...restProps\n}: WriteBarProps) => {\n  const platform = usePlatform();\n\n  const [value, onChange] = useEnsuredControl({\n    defaultValue,\n    ...restProps,\n  });\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = '';\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (textareaEl.scrollHeight !== currentScrollHeight.current && onHeightChange) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  React.useEffect(resize, [resize, value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      className={classNames(\n        styles['WriteBar'],\n        platform === Platform.IOS && styles['WriteBar--ios'],\n        shadow && styles['WriteBar--shadow'],\n        className,\n      )}\n      style={style}\n    >\n      <div className={styles['WriteBar__form']}>\n        {hasReactNode(before) && <div className={styles['WriteBar__before']}>{before}</div>}\n\n        <div className={styles['WriteBar__formIn']}>\n          <Headline\n            {...restProps}\n            Component=\"textarea\"\n            className={styles['WriteBar__textarea']}\n            onChange={onChange}\n            getRootRef={textareaRef}\n            value={value}\n          />\n          {hasReactNode(inlineAfter) && (\n            <div className={styles['WriteBar__inlineAfter']}>{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div className={styles['WriteBar__after']}>{after}</div>}\n      </div>\n    </div>\n  );\n};\n"],"mappings":";;;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,QAAQ,QAAQ,iCAAiC;AAC1D,SAASC,WAAW,QAAQ,yBAAyB;AACrD,SAASC,YAAY,QAAQ,0BAA0B;AACvD,SAASC,UAAU,EAAEC,YAAY,QAAQ,iBAAiB;AAC1D,SAASC,QAAQ,QAAQ,oBAAoB;AAE7C,SAASC,iBAAiB,QAAQ,+BAA+B;AAAC;AA+BlE;AACA;AACA;AACA,OAAO,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,OAYA;EAAA,IAXnBC,SAAS,QAATA,SAAS;IACTC,KAAK,QAALA,KAAK;IACLC,MAAM,QAANA,MAAM;IACNC,WAAW,QAAXA,WAAW;IACXC,KAAK,QAALA,KAAK;IACLC,UAAU,QAAVA,UAAU;IACVC,MAAM,QAANA,MAAM;IACNC,cAAc,QAAdA,cAAc;IAAA,mBACdC,MAAM;IAANA,MAAM,4BAAG,KAAK;IACdC,YAAY,QAAZA,YAAY;IACTC,SAAS;EAEZ,IAAMC,QAAQ,GAAGlB,WAAW,EAAE;EAE9B,yBAA0BK,iBAAiB;MACzCW,YAAY,EAAZA;IAAY,GACTC,SAAS,EACZ;IAAA;IAHKE,KAAK;IAAEC,QAAQ;EAKtB,IAAMC,WAAW,GAAGpB,YAAY,CAACY,MAAM,CAAC;EACxC,IAAMS,mBAAmB,GAAGxB,KAAK,CAACyB,MAAM,EAAU;EAElD,IAAMC,MAAM,GAAG1B,KAAK,CAAC2B,WAAW,CAAC,YAAM;IACrC,IAAMC,UAAU,GAAGL,WAAW,CAACM,OAAO;IACtC,IAAI,CAACD,UAAU,EAAE;MACf;IACF;IAEA,IAAIA,UAAU,CAACE,YAAY,EAAE;MAC3BF,UAAU,CAAClB,KAAK,CAACqB,MAAM,GAAG,EAAE;MAC5BH,UAAU,CAAClB,KAAK,CAACqB,MAAM,aAAMH,UAAU,CAACI,YAAY,OAAI;MAExD,IAAIJ,UAAU,CAACI,YAAY,KAAKR,mBAAmB,CAACK,OAAO,IAAIb,cAAc,EAAE;QAC7EA,cAAc,EAAE;QAChBQ,mBAAmB,CAACK,OAAO,GAAGD,UAAU,CAACI,YAAY;MACvD;IACF;EACF,CAAC,EAAE,CAAChB,cAAc,EAAEO,WAAW,CAAC,CAAC;EAEjCvB,KAAK,CAACiC,SAAS,CAACP,MAAM,EAAE,CAACA,MAAM,EAAEL,KAAK,CAAC,CAAC;EAExC,oBACE;IACE,GAAG,EAAEP,UAAW;IAChB,SAAS,EAAEV,UAAU,iBAEnBgB,QAAQ,KAAKd,QAAQ,CAAC4B,GAAG,uBAA2B,EACpDjB,MAAM,0BAA8B,EACpCR,SAAS,CACT;IACF,KAAK,EAAEC;EAAM,gBAEb;IAAK,SAAS;EAA2B,GACtCL,YAAY,CAACM,MAAM,CAAC,iBAAI;IAAK,SAAS;EAA6B,GAAEA,MAAM,CAAO,eAEnF;IAAK,SAAS;EAA6B,gBACzC,oBAAC,QAAQ,eACHQ,SAAS;IACb,SAAS,EAAC,UAAU;IACpB,SAAS,0BAA+B;IACxC,QAAQ,EAAEG,QAAS;IACnB,UAAU,EAAEC,WAAY;IACxB,KAAK,EAAEF;EAAM,GACb,EACDhB,YAAY,CAACO,WAAW,CAAC,iBACxB;IAAK,SAAS;EAAkC,GAAEA,WAAW,CAC9D,CACG,EAELP,YAAY,CAACQ,KAAK,CAAC,iBAAI;IAAK,SAAS;EAA4B,GAAEA,KAAK,CAAO,CAC5E,CACF;AAEV,CAAC"}