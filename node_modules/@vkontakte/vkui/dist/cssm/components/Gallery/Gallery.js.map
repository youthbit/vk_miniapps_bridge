{"version":3,"file":"Gallery.js","names":["React","clamp","useTimeout","BaseGallery","Gallery","initialSlideIndex","children","timeout","onChange","bullets","props","useState","localSlideIndex","setSlideIndex","isControlled","slideIndex","isDraggable","Boolean","slides","useMemo","Children","toArray","filter","item","childCount","length","handleChange","useCallback","current","autoplay","useEffect","set","clear","safeSlideIndex"],"sources":["../../../../src/components/Gallery/Gallery.tsx"],"sourcesContent":["import * as React from 'react';\nimport { clamp } from '../../helpers/math';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { BaseGallery } from '../BaseGallery/BaseGallery';\nimport { BaseGalleryProps } from '../BaseGallery/types';\n\nexport interface GalleryProps extends BaseGalleryProps {\n  initialSlideIndex?: number;\n  timeout?: number;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  ...props\n}: GalleryProps) => {\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === 'number';\n  const slideIndex = isControlled ? props.slideIndex ?? 0 : localSlideIndex;\n  const isDraggable = !isControlled || Boolean(onChange);\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children],\n  );\n  const childCount = slides.length;\n\n  const handleChange: GalleryProps['onChange'] = React.useCallback(\n    (current: number) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex],\n  );\n\n  const autoplay = useTimeout(() => handleChange((slideIndex + 1) % childCount), timeout);\n  React.useEffect(\n    () => (timeout ? autoplay.set() : autoplay.clear()),\n    [timeout, slideIndex, autoplay],\n  );\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  return (\n    <BaseGallery\n      isDraggable={isDraggable}\n      {...props}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </BaseGallery>\n  );\n};\n"],"mappings":";;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,KAAK,QAAQ,oBAAoB;AAC1C,SAASC,UAAU,QAAQ,wBAAwB;AACnD,SAASC,WAAW,QAAQ,4BAA4B;AAQxD;AACA;AACA;AACA,OAAO,IAAMC,OAAO,GAAG,SAAVA,OAAO,OAOA;EAAA;EAAA,iCANlBC,iBAAiB;IAAjBA,iBAAiB,sCAAG,CAAC;IACrBC,QAAQ,QAARA,QAAQ;IAAA,oBACRC,OAAO;IAAPA,OAAO,6BAAG,CAAC;IACXC,QAAQ,QAARA,QAAQ;IACRC,OAAO,QAAPA,OAAO;IACJC,KAAK;EAER,sBAAyCV,KAAK,CAACW,QAAQ,CAACN,iBAAiB,CAAC;IAAA;IAAnEO,eAAe;IAAEC,aAAa;EACrC,IAAMC,YAAY,GAAG,OAAOJ,KAAK,CAACK,UAAU,KAAK,QAAQ;EACzD,IAAMA,UAAU,GAAGD,YAAY,wBAAGJ,KAAK,CAACK,UAAU,iEAAI,CAAC,GAAGH,eAAe;EACzE,IAAMI,WAAW,GAAG,CAACF,YAAY,IAAIG,OAAO,CAACT,QAAQ,CAAC;EACtD,IAAMU,MAAM,GAAGlB,KAAK,CAACmB,OAAO,CAC1B;IAAA,OAAMnB,KAAK,CAACoB,QAAQ,CAACC,OAAO,CAACf,QAAQ,CAAC,CAACgB,MAAM,CAAC,UAACC,IAAI;MAAA,OAAKN,OAAO,CAACM,IAAI,CAAC;IAAA,EAAC;EAAA,GACtE,CAACjB,QAAQ,CAAC,CACX;EACD,IAAMkB,UAAU,GAAGN,MAAM,CAACO,MAAM;EAEhC,IAAMC,YAAsC,GAAG1B,KAAK,CAAC2B,WAAW,CAC9D,UAACC,OAAe,EAAK;IACnB,IAAIA,OAAO,KAAKb,UAAU,EAAE;MAC1B;IACF;IACA,CAACD,YAAY,IAAID,aAAa,CAACe,OAAO,CAAC;IACvCpB,QAAQ,IAAIA,QAAQ,CAACoB,OAAO,CAAC;EAC/B,CAAC,EACD,CAACd,YAAY,EAAEN,QAAQ,EAAEO,UAAU,CAAC,CACrC;EAED,IAAMc,QAAQ,GAAG3B,UAAU,CAAC;IAAA,OAAMwB,YAAY,CAAC,CAACX,UAAU,GAAG,CAAC,IAAIS,UAAU,CAAC;EAAA,GAAEjB,OAAO,CAAC;EACvFP,KAAK,CAAC8B,SAAS,CACb;IAAA,OAAOvB,OAAO,GAAGsB,QAAQ,CAACE,GAAG,EAAE,GAAGF,QAAQ,CAACG,KAAK,EAAE;EAAA,CAAC,EACnD,CAACzB,OAAO,EAAEQ,UAAU,EAAEc,QAAQ,CAAC,CAChC;;EAED;EACA;EACA,IAAMI,cAAc,GAAGT,UAAU,GAAG,CAAC,GAAGvB,KAAK,CAACc,UAAU,EAAE,CAAC,EAAES,UAAU,GAAG,CAAC,CAAC,GAAGT,UAAU;EACzF;EACAf,KAAK,CAAC8B,SAAS,CAAC,YAAM;IACpB,IAAItB,QAAQ,IAAIyB,cAAc,KAAKlB,UAAU,EAAE;MAC7CP,QAAQ,CAACyB,cAAc,CAAC;IAC1B;IACApB,aAAa,CAACoB,cAAc,CAAC;EAC/B,CAAC,EAAE,CAACzB,QAAQ,EAAEyB,cAAc,EAAElB,UAAU,CAAC,CAAC;EAE1C,oBACE,oBAAC,WAAW;IACV,WAAW,EAAEC;EAAY,GACrBN,KAAK;IACT,OAAO,EAAEc,UAAU,GAAG,CAAC,IAAIf,OAAQ;IACnC,UAAU,EAAEwB,cAAe;IAC3B,QAAQ,EAAEP;EAAa,IAEtBR,MAAM,CACK;AAElB,CAAC"}