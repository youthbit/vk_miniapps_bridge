{"version":3,"file":"useAdaptivityWithJSMediaQueries.js","names":["React","canUseDOM","hasMouse","hasPointerLib","hasHover","hasHoverLib","AdaptivityContext","getOrDefault","getViewWidthByMediaQueries","getViewHeightByMediaQueries","getSizeX","getSizeY","tryToCheckIsDesktop","useMediaQueries","usePlatform","matchMediaListAddListener","matchMediaListRemoveListener","useAdaptivityWithJSMediaQueries","console","error","useContext","viewWidthContext","viewWidth","viewHeightContext","viewHeight","sizeXContext","sizeX","sizeYContext","sizeY","hasPointerContext","hasPointer","hasHoverContext","platform","mediaQueries","useState","viewWidthLocal","viewHeightLocal","setViewSizeLocal","adaptivityProps","useMemo","isDesktop","useEffect","handleMediaQuery","prevSizeLocal","newViewWidthLocal","newViewHeightLocal","prevViewWidthLocal","prevViewHeightLocal","desktopPlus","tablet","smallTablet","mobile","forEach","matchMediaListener","mediumHeight","mobileLandscapeHeight"],"sources":["../../../src/hooks/useAdaptivityWithJSMediaQueries.ts"],"sourcesContent":["import * as React from 'react';\nimport { canUseDOM, hasMouse as hasPointerLib, hasHover as hasHoverLib } from '@vkontakte/vkjs';\nimport {\n  AdaptivityContext,\n  type AdaptivityProps as BaseAdaptivityProps,\n} from '../components/AdaptivityProvider/AdaptivityContext';\nimport { getOrDefault } from '../helpers/getOrDefault';\nimport {\n  getViewWidthByMediaQueries,\n  getViewHeightByMediaQueries,\n  getSizeX,\n  getSizeY,\n  tryToCheckIsDesktop,\n} from '../lib/adaptivity';\nimport { useMediaQueries } from './useMediaQueries';\nimport { usePlatform } from './usePlatform';\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from '../lib/matchMedia';\n\nexport interface UseAdaptivityWithJSMediaQueries extends Required<BaseAdaptivityProps> {\n  isDesktop: boolean;\n}\n\n/**\n * Высчитывает и возвращает параметры адаптивности при изменении вьюпорта.\n *\n * Берёт в приоритет значения из `AdaptivityContext`.\n *\n * > ⚠ SSR\n * >\n * > Во избежания ошибок при гидратации, не используйте данный хук, если есть вероятность, что компонент будет отрендерен\n * > на стороне сервера.\n * >\n * > Лучше всего использовать для всплывающих окон, т.к. они вызываются только после загрузки\n * > страницы либо пользователем, либо программно.\n */\nexport const useAdaptivityWithJSMediaQueries = (): UseAdaptivityWithJSMediaQueries => {\n  if (!canUseDOM) {\n    console.error(`[useAdaptivityWithJSMediaQueries] Похоже, вы пытаетесь использовать хук вне браузера.\n\nПостарайтесь этого избегать, чтобы не было ошибок при гидратации: при SSR нет информации о размерах экрана.\n\nИспользуйте CSS Media Query или библиотеку по типу https://github.com/artsy/fresnel.`);\n  }\n\n  const {\n    viewWidth: viewWidthContext,\n    viewHeight: viewHeightContext,\n    sizeX: sizeXContext,\n    sizeY: sizeYContext,\n    hasPointer: hasPointerContext,\n    hasHover: hasHoverContext,\n  } = React.useContext(AdaptivityContext);\n\n  const platform = usePlatform();\n  const mediaQueries = useMediaQueries();\n\n  const [[viewWidthLocal, viewHeightLocal], setViewSizeLocal] = React.useState(() => [\n    getOrDefault(viewWidthContext, getViewWidthByMediaQueries(mediaQueries)),\n    getOrDefault(viewHeightContext, getViewHeightByMediaQueries(mediaQueries)),\n  ]);\n\n  const adaptivityProps = React.useMemo(() => {\n    const hasPointer = getOrDefault(hasPointerContext, hasPointerLib);\n    const hasHover = getOrDefault(hasHoverContext, hasHoverLib);\n    const viewWidth = getOrDefault(viewWidthContext, viewWidthLocal);\n    const viewHeight = getOrDefault(viewHeightContext, viewHeightLocal);\n    const sizeX = getOrDefault(sizeXContext, getSizeX(viewWidth));\n    const sizeY = getOrDefault(sizeYContext, getSizeY(viewWidth, viewHeight, hasPointer));\n    const isDesktop = tryToCheckIsDesktop(viewWidth, viewHeight, hasPointer, platform);\n\n    return {\n      viewWidth,\n      viewHeight,\n      sizeX,\n      sizeY,\n      hasPointer,\n      hasHover,\n      isDesktop,\n    };\n  }, [\n    viewWidthLocal,\n    viewHeightLocal,\n    viewWidthContext,\n    viewHeightContext,\n    sizeXContext,\n    sizeYContext,\n    hasPointerContext,\n    hasHoverContext,\n    platform,\n  ]);\n\n  React.useEffect(() => {\n    const handleMediaQuery = () => {\n      setViewSizeLocal((prevSizeLocal) => {\n        const newViewWidthLocal = getOrDefault(\n          viewWidthContext,\n          getViewWidthByMediaQueries(mediaQueries),\n        );\n        const newViewHeightLocal = getOrDefault(\n          viewHeightContext,\n          getViewHeightByMediaQueries(mediaQueries),\n        );\n\n        const [prevViewWidthLocal, prevViewHeightLocal] = prevSizeLocal;\n\n        if (\n          prevViewWidthLocal !== newViewWidthLocal ||\n          prevViewHeightLocal !== newViewHeightLocal\n        ) {\n          return [newViewWidthLocal, newViewHeightLocal];\n        }\n\n        return prevSizeLocal;\n      });\n    };\n\n    if (!viewWidthContext) {\n      [\n        mediaQueries.desktopPlus,\n        mediaQueries.tablet,\n        mediaQueries.smallTablet,\n        mediaQueries.mobile,\n      ].forEach((matchMediaListener) =>\n        matchMediaListAddListener(matchMediaListener, handleMediaQuery),\n      );\n    }\n\n    if (!viewHeightContext) {\n      [mediaQueries.mediumHeight, mediaQueries.mobileLandscapeHeight].forEach(\n        (matchMediaListener) => matchMediaListAddListener(matchMediaListener, handleMediaQuery),\n      );\n    }\n\n    return () => {\n      [\n        mediaQueries.desktopPlus,\n        mediaQueries.tablet,\n        mediaQueries.smallTablet,\n        mediaQueries.mobile,\n        mediaQueries.mediumHeight,\n        mediaQueries.mobileLandscapeHeight,\n      ].forEach((matchMediaListener) =>\n        matchMediaListRemoveListener(matchMediaListener, handleMediaQuery),\n      );\n    };\n  }, [mediaQueries, viewWidthContext, viewHeightContext]);\n\n  return adaptivityProps;\n};\n"],"mappings":"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"}