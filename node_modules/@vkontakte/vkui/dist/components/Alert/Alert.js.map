{"version":3,"file":"Alert.js","names":["React","Tappable","PopoutWrapper","classNames","hasReactNode","Platform","Button","stopPropagation","Title","Caption","Footnote","Text","ModalDismissButton","FocusTrap","useScrollLock","useWaitTransitionFinish","usePlatform","useAdaptivityWithJSMediaQueries","AlertHeader","props","platform","IOS","AlertText","VKCOM","AlertAction","action","onItemClick","restProps","handleItemClick","useCallback","Component","title","actionProp","autoClose","mode","restActionProps","href","styles","target","Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","isDesktop","waitTransitionFinish","useState","closing","setClosing","elementRef","useRef","resolvedActionsLayout","timeout","close","current","e","propertyName","item","map","i"],"sources":["../../../src/components/Alert/Alert.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Tappable } from '../Tappable/Tappable';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { Platform } from '../../lib/platform';\nimport { Button, ButtonProps } from '../Button/Button';\nimport { stopPropagation } from '../../lib/utils';\nimport { Title } from '../Typography/Title/Title';\nimport { Caption } from '../Typography/Caption/Caption';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { Text } from '../Typography/Text/Text';\nimport { ModalDismissButton } from '../ModalDismissButton/ModalDismissButton';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { useWaitTransitionFinish } from '../../hooks/useWaitTransitionFinish';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { AnchorHTMLAttributesOnly } from '../../types';\nimport styles from './Alert.module.css';\n\nexport interface AlertActionInterface\n  extends Pick<ButtonProps, 'Component'>,\n    AnchorHTMLAttributesOnly {\n  title: string;\n  action?: VoidFunction;\n  autoClose?: boolean;\n  mode: 'cancel' | 'destructive' | 'default';\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement> {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: AlertActionInterface[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose: VoidFunction;\n\n  /**\n   * `aria-label` для кнопки закрытия. Необходим, чтобы кнопка была доступной.\n   */\n  dismissLabel?: string;\n}\n\ntype ItemClickHandler = (item: AlertActionInterface) => void;\n\ninterface AlertTypography {\n  id: string;\n  children?: React.ReactNode;\n}\n\nconst AlertHeader = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case Platform.IOS:\n      return <Title className={styles['Alert__header']} weight=\"1\" level=\"3\" {...props} />;\n    default:\n      return <Title className={styles['Alert__header']} weight=\"2\" level=\"2\" {...props} />;\n  }\n};\n\nconst AlertText = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case Platform.VKCOM:\n      return <Footnote className={styles['Alert__text']} {...props} />;\n    case Platform.IOS:\n      return <Caption className={styles['Alert__text']} {...props} />;\n    default:\n      return <Text Component=\"span\" className={styles['Alert__text']} weight=\"3\" {...props} />;\n  }\n};\n\ninterface AlertActionProps {\n  action: AlertActionInterface;\n  onItemClick: ItemClickHandler;\n}\n\nconst AlertAction = ({ action, onItemClick, ...restProps }: AlertActionProps) => {\n  const platform = usePlatform();\n  const handleItemClick = React.useCallback(() => onItemClick(action), [onItemClick, action]);\n\n  if (platform === Platform.IOS) {\n    const {\n      Component = 'button',\n      title,\n      action: actionProp,\n      autoClose,\n      mode,\n      ...restActionProps\n    } = action;\n\n    return (\n      <Tappable\n        Component={restActionProps.href ? 'a' : Component}\n        className={classNames(styles['Alert__action'], styles[`Alert__action--mode-${mode}`])}\n        onClick={handleItemClick}\n        {...restActionProps}\n        {...restProps}\n      >\n        {title}\n      </Tappable>\n    );\n  }\n\n  let mode: ButtonProps['mode'] = 'tertiary';\n\n  if (platform === Platform.VKCOM) {\n    mode = action.mode === 'cancel' ? 'secondary' : 'primary';\n  }\n\n  return (\n    <Button\n      className={classNames(styles['Alert__button'], styles[`Alert__button--mode-${action.mode}`])}\n      mode={mode}\n      size=\"m\"\n      onClick={handleItemClick}\n      Component={action.Component}\n      href={action.href}\n      target={action.target}\n    >\n      {action.title}\n    </Button>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert = ({\n  actions = [],\n  actionsLayout = 'horizontal',\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = 'Закрыть предупреждение',\n  ...restProps\n}: AlertProps) => {\n  const platform = usePlatform();\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const resolvedActionsLayout: AlertProps['actionsLayout'] =\n    platform === Platform.VKCOM ? 'horizontal' : actionsLayout;\n\n  const timeout = platform === Platform.IOS ? 300 : 200;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          onClose();\n        }\n      },\n      timeout,\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick: ItemClickHandler = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoClose } = item;\n\n      if (autoClose) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === 'opacity') {\n              onClose();\n              action && action();\n            }\n          },\n          timeout,\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout],\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper className={className} closing={closing} style={style} onClick={close}>\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        className={classNames(\n          styles['Alert'],\n          platform === Platform.IOS && styles['Alert--ios'],\n          platform === Platform.VKCOM && styles['Alert--vkcom'],\n          resolvedActionsLayout === 'vertical' ? styles['Alert--v'] : styles['Alert--h'],\n          closing && styles['Alert--closing'],\n          isDesktop && styles['Alert--desktop'],\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby=\"vkui--alert--title\"\n        aria-describedby=\"vkui--alert--desc\"\n      >\n        <div className={styles['Alert__content']}>\n          {hasReactNode(header) && <AlertHeader id=\"vkui--alert--title\">{header}</AlertHeader>}\n          {hasReactNode(text) && <AlertText id=\"vkui--alert--desc\">{text}</AlertText>}\n          {children}\n        </div>\n        <div className={styles['Alert__actions']}>\n          {actions.map((action, i) => (\n            <AlertAction key={i} action={action} onItemClick={onItemClick} />\n          ))}\n        </div>\n        {isDesktop && <ModalDismissButton onClick={close} aria-label={dismissLabel} />}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"mappings":";;;;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,QAAQ,QAAQ,sBAAsB;AAC/C,SAASC,aAAa,QAAQ,gCAAgC;AAC9D,SAASC,UAAU,EAAEC,YAAY,QAAQ,iBAAiB;AAC1D,SAASC,QAAQ,QAAQ,oBAAoB;AAC7C,SAASC,MAAM,QAAqB,kBAAkB;AACtD,SAASC,eAAe,QAAQ,iBAAiB;AACjD,SAASC,KAAK,QAAQ,2BAA2B;AACjD,SAASC,OAAO,QAAQ,+BAA+B;AACvD,SAASC,QAAQ,QAAQ,iCAAiC;AAC1D,SAASC,IAAI,QAAQ,yBAAyB;AAC9C,SAASC,kBAAkB,QAAQ,0CAA0C;AAC7E,SAASC,SAAS,QAAQ,wBAAwB;AAClD,SAASC,aAAa,QAAQ,0BAA0B;AACxD,SAASC,uBAAuB,QAAQ,qCAAqC;AAC7E,SAASC,WAAW,QAAQ,yBAAyB;AACrD,SAASC,+BAA+B,QAAQ,6CAA6C;AAiC7F,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIC,KAAsB,EAAK;EAC9C,IAAMC,QAAQ,GAAGJ,WAAW,EAAE;EAE9B,QAAQI,QAAQ;IACd,KAAKf,QAAQ,CAACgB,GAAG;MACf,oBAAO,oBAAC,KAAK;QAAC,SAAS,qBAA0B;QAAC,MAAM,EAAC,GAAG;QAAC,KAAK,EAAC;MAAG,GAAKF,KAAK,EAAI;IACtF;MACE,oBAAO,oBAAC,KAAK;QAAC,SAAS,qBAA0B;QAAC,MAAM,EAAC,GAAG;QAAC,KAAK,EAAC;MAAG,GAAKA,KAAK,EAAI;EAAC;AAE3F,CAAC;AAED,IAAMG,SAAS,GAAG,SAAZA,SAAS,CAAIH,KAAsB,EAAK;EAC5C,IAAMC,QAAQ,GAAGJ,WAAW,EAAE;EAE9B,QAAQI,QAAQ;IACd,KAAKf,QAAQ,CAACkB,KAAK;MACjB,oBAAO,oBAAC,QAAQ;QAAC,SAAS;MAAwB,GAAKJ,KAAK,EAAI;IAClE,KAAKd,QAAQ,CAACgB,GAAG;MACf,oBAAO,oBAAC,OAAO;QAAC,SAAS;MAAwB,GAAKF,KAAK,EAAI;IACjE;MACE,oBAAO,oBAAC,IAAI;QAAC,SAAS,EAAC,MAAM;QAAC,SAAS,mBAAwB;QAAC,MAAM,EAAC;MAAG,GAAKA,KAAK,EAAI;EAAC;AAE/F,CAAC;AAOD,IAAMK,WAAW,GAAG,SAAdA,WAAW,OAAgE;EAAA,IAA1DC,MAAM,QAANA,MAAM;IAAEC,WAAW,QAAXA,WAAW;IAAKC,SAAS;EACtD,IAAMP,QAAQ,GAAGJ,WAAW,EAAE;EAC9B,IAAMY,eAAe,GAAG5B,KAAK,CAAC6B,WAAW,CAAC;IAAA,OAAMH,WAAW,CAACD,MAAM,CAAC;EAAA,GAAE,CAACC,WAAW,EAAED,MAAM,CAAC,CAAC;EAE3F,IAAIL,QAAQ,KAAKf,QAAQ,CAACgB,GAAG,EAAE;IAC7B,wBAOII,MAAM,CANRK,SAAS;MAATA,SAAS,kCAAG,QAAQ;MACpBC,KAAK,GAKHN,MAAM,CALRM,KAAK;MACGC,UAAU,GAIhBP,MAAM,CAJRA,MAAM;MACNQ,SAAS,GAGPR,MAAM,CAHRQ,SAAS;MACTC,KAAI,GAEFT,MAAM,CAFRS,IAAI;MACDC,eAAe,4BAChBV,MAAM;IAEV,oBACE,oBAAC,QAAQ;MACP,SAAS,EAAEU,eAAe,CAACC,IAAI,GAAG,GAAG,GAAGN,SAAU;MAClD,SAAS,EAAE3B,UAAU,sBAA0BkC,MAAM,+BAAwBH,KAAI,EAAG,CAAE;MACtF,OAAO,EAAEN;IAAgB,GACrBO,eAAe,EACfR,SAAS,GAEZI,KAAK,CACG;EAEf;EAEA,IAAIG,IAAyB,GAAG,UAAU;EAE1C,IAAId,QAAQ,KAAKf,QAAQ,CAACkB,KAAK,EAAE;IAC/BW,IAAI,GAAGT,MAAM,CAACS,IAAI,KAAK,QAAQ,GAAG,WAAW,GAAG,SAAS;EAC3D;EAEA,oBACE,oBAAC,MAAM;IACL,SAAS,EAAE/B,UAAU,sBAA0BkC,MAAM,+BAAwBZ,MAAM,CAACS,IAAI,EAAG,CAAE;IAC7F,IAAI,EAAEA,IAAK;IACX,IAAI,EAAC,GAAG;IACR,OAAO,EAAEN,eAAgB;IACzB,SAAS,EAAEH,MAAM,CAACK,SAAU;IAC5B,IAAI,EAAEL,MAAM,CAACW,IAAK;IAClB,MAAM,EAAEX,MAAM,CAACa;EAAO,GAErBb,MAAM,CAACM,KAAK,CACN;AAEb,CAAC;;AAED;AACA;AACA;AACA,OAAO,IAAMQ,KAAK,GAAG,SAARA,KAAK,QAWA;EAAA,0BAVhBC,OAAO;IAAPA,OAAO,8BAAG,EAAE;IAAA,4BACZC,aAAa;IAAbA,aAAa,oCAAG,YAAY;IAC5BC,QAAQ,SAARA,QAAQ;IACRC,SAAS,SAATA,SAAS;IACTC,KAAK,SAALA,KAAK;IACLC,IAAI,SAAJA,IAAI;IACJC,MAAM,SAANA,MAAM;IACNC,OAAO,SAAPA,OAAO;IAAA,2BACPC,YAAY;IAAZA,YAAY,mCAAG,wBAAwB;IACpCrB,SAAS;EAEZ,IAAMP,QAAQ,GAAGJ,WAAW,EAAE;EAC9B,4BAAsBC,+BAA+B,EAAE;IAA/CgC,SAAS,yBAATA,SAAS;EACjB,4BAAiClC,uBAAuB,EAAE;IAAlDmC,oBAAoB,yBAApBA,oBAAoB;EAE5B,sBAA8BlD,KAAK,CAACmD,QAAQ,CAAC,KAAK,CAAC;IAAA;IAA5CC,OAAO;IAAEC,UAAU;EAE1B,IAAMC,UAAU,GAAGtD,KAAK,CAACuD,MAAM,CAAiB,IAAI,CAAC;EAErD,IAAMC,qBAAkD,GACtDpC,QAAQ,KAAKf,QAAQ,CAACkB,KAAK,GAAG,YAAY,GAAGkB,aAAa;EAE5D,IAAMgB,OAAO,GAAGrC,QAAQ,KAAKf,QAAQ,CAACgB,GAAG,GAAG,GAAG,GAAG,GAAG;EAErD,IAAMqC,KAAK,GAAG1D,KAAK,CAAC6B,WAAW,CAAC,YAAM;IACpCwB,UAAU,CAAC,IAAI,CAAC;IAChBH,oBAAoB,CAClBI,UAAU,CAACK,OAAO,EAClB,UAACC,CAAmB,EAAK;MACvB,IAAI,CAACA,CAAC,IAAIA,CAAC,CAACC,YAAY,KAAK,SAAS,EAAE;QACtCd,OAAO,EAAE;MACX;IACF,CAAC,EACDU,OAAO,CACR;EACH,CAAC,EAAE,CAACH,UAAU,EAAEJ,oBAAoB,EAAEH,OAAO,EAAEU,OAAO,CAAC,CAAC;EAExD,IAAM/B,WAA6B,GAAG1B,KAAK,CAAC6B,WAAW,CACrD,UAACiC,IAA0B,EAAK;IAC9B,IAAQrC,MAAM,GAAgBqC,IAAI,CAA1BrC,MAAM;MAAEQ,SAAS,GAAK6B,IAAI,CAAlB7B,SAAS;IAEzB,IAAIA,SAAS,EAAE;MACboB,UAAU,CAAC,IAAI,CAAC;MAChBH,oBAAoB,CAClBI,UAAU,CAACK,OAAO,EAClB,UAACC,CAAmB,EAAK;QACvB,IAAI,CAACA,CAAC,IAAIA,CAAC,CAACC,YAAY,KAAK,SAAS,EAAE;UACtCd,OAAO,EAAE;UACTtB,MAAM,IAAIA,MAAM,EAAE;QACpB;MACF,CAAC,EACDgC,OAAO,CACR;IACH,CAAC,MAAM;MACLhC,MAAM,IAAIA,MAAM,EAAE;IACpB;EACF,CAAC,EACD,CAAC6B,UAAU,EAAEJ,oBAAoB,EAAEH,OAAO,EAAEU,OAAO,CAAC,CACrD;EAED3C,aAAa,EAAE;EAEf,oBACE,oBAAC,aAAa;IAAC,SAAS,EAAE6B,SAAU;IAAC,OAAO,EAAES,OAAQ;IAAC,KAAK,EAAER,KAAM;IAAC,OAAO,EAAEc;EAAM,gBAClF,oBAAC,SAAS,eACJ/B,SAAS;IACb,UAAU,EAAE2B,UAAW;IACvB,OAAO,EAAE/C,eAAgB;IACzB,OAAO,EAAEmD,KAAM;IACf,OAAO,EAAED,OAAQ;IACjB,SAAS,EAAEtD,UAAU,cAEnBiB,QAAQ,KAAKf,QAAQ,CAACgB,GAAG,oBAAwB,EACjDD,QAAQ,KAAKf,QAAQ,CAACkB,KAAK,sBAA0B,EACrDiC,qBAAqB,KAAK,UAAU,kCAA0C,EAC9EJ,OAAO,wBAA4B,EACnCH,SAAS,wBAA4B,CACrC;IACF,IAAI,EAAC,aAAa;IAClB,kBAAU;IACV,mBAAgB,oBAAoB;IACpC,oBAAiB;EAAmB,iBAEpC;IAAK,SAAS;EAA2B,GACtC7C,YAAY,CAAC0C,MAAM,CAAC,iBAAI,oBAAC,WAAW;IAAC,EAAE,EAAC;EAAoB,GAAEA,MAAM,CAAe,EACnF1C,YAAY,CAACyC,IAAI,CAAC,iBAAI,oBAAC,SAAS;IAAC,EAAE,EAAC;EAAmB,GAAEA,IAAI,CAAa,EAC1EH,QAAQ,CACL,eACN;IAAK,SAAS;EAA2B,GACtCF,OAAO,CAACuB,GAAG,CAAC,UAACtC,MAAM,EAAEuC,CAAC;IAAA,oBACrB,oBAAC,WAAW;MAAC,GAAG,EAAEA,CAAE;MAAC,MAAM,EAAEvC,MAAO;MAAC,WAAW,EAAEC;IAAY,EAAG;EAAA,CAClE,CAAC,CACE,EACLuB,SAAS,iBAAI,oBAAC,kBAAkB;IAAC,OAAO,EAAES,KAAM;IAAC,cAAYV;EAAa,EAAG,CACpE,CACE;AAEpB,CAAC;AAAC;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;AAAA"}