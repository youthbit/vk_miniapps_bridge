{"version":3,"file":"useInsets.js","names":["React","vkBridge","useIsomorphicLayoutEffect","initialState","bottom","top","left","right","resolveInsets","e","detail","type","data","insets","subscribe","useInsets","useState","setInsets","connectListener","unsubscribe"],"sources":["../../src/hooks/useInsets.ts"],"sourcesContent":["import * as React from 'react';\nimport vkBridge, { Insets as BridgeInsets } from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport interface Insets {\n  bottom: BridgeInsets['bottom'] | null;\n  top: BridgeInsets['top'] | null;\n  left: BridgeInsets['left'] | null;\n  right: BridgeInsets['right'] | null;\n}\n\nlet initialState: Insets = {\n  bottom: null,\n  top: null,\n  left: null,\n  right: null,\n};\n\ninterface BridgeEvent {\n  detail: {\n    type: string;\n    data: {\n      [index: string]: any;\n    };\n  };\n}\n\nfunction resolveInsets(e: BridgeEvent): Insets | null {\n  const { type, data } = e.detail;\n  switch (type) {\n    case 'VKWebAppUpdateConfig':\n    case 'VKWebAppUpdateInsets': // Устаревшее событие vk-bridge\n      const { insets } = data;\n      if (insets) {\n        return {\n          ...insets,\n          bottom: insets.bottom > 150 ? 0 : insets.bottom, // если больше 150 – значит открылась клава и она сама работает как инсет, то есть наш нужно занулить\n        };\n      }\n  }\n  return null;\n}\n\nvkBridge.subscribe((e: BridgeEvent) => {\n  const insets = resolveInsets(e);\n  if (insets) {\n    initialState = insets;\n  }\n});\n\nexport function useInsets(): Insets {\n  const [insets, setInsets] = React.useState<Insets>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    function connectListener(e: BridgeEvent) {\n      const insets = resolveInsets(e);\n      if (insets) {\n        setInsets(insets);\n      }\n    }\n\n    vkBridge.subscribe(connectListener);\n    return () => {\n      vkBridge.unsubscribe(connectListener);\n    };\n  }, []);\n\n  return insets;\n}\n"],"mappings":";;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,OAAOC,QAAQ,MAAkC,sBAAsB;AACvE,SAASC,yBAAyB,QAAQ,kCAAkC;AAS5E,IAAIC,YAAoB,GAAG;EACzBC,MAAM,EAAE,IAAI;EACZC,GAAG,EAAE,IAAI;EACTC,IAAI,EAAE,IAAI;EACVC,KAAK,EAAE;AACT,CAAC;AAWD,SAASC,aAAa,CAACC,CAAc,EAAiB;EACpD,gBAAuBA,CAAC,CAACC,MAAM;IAAvBC,IAAI,aAAJA,IAAI;IAAEC,IAAI,aAAJA,IAAI;EAClB,QAAQD,IAAI;IACV,KAAK,sBAAsB;IAC3B,KAAK,sBAAsB;MAAE;MAC3B,IAAQE,MAAM,GAAKD,IAAI,CAAfC,MAAM;MACd,IAAIA,MAAM,EAAE;QACV,uCACKA,MAAM;UACTT,MAAM,EAAES,MAAM,CAACT,MAAM,GAAG,GAAG,GAAG,CAAC,GAAGS,MAAM,CAACT,MAAM,CAAE;QAAA;MAErD;EAAC;;EAEL,OAAO,IAAI;AACb;AAEAH,QAAQ,CAACa,SAAS,CAAC,UAACL,CAAc,EAAK;EACrC,IAAMI,MAAM,GAAGL,aAAa,CAACC,CAAC,CAAC;EAC/B,IAAII,MAAM,EAAE;IACVV,YAAY,GAAGU,MAAM;EACvB;AACF,CAAC,CAAC;AAEF,OAAO,SAASE,SAAS,GAAW;EAClC,sBAA4Bf,KAAK,CAACgB,QAAQ,CAASb,YAAY,CAAC;IAAA;IAAzDU,MAAM;IAAEI,SAAS;EAExBf,yBAAyB,CAAC,YAAM;IAC9B,SAASgB,eAAe,CAACT,CAAc,EAAE;MACvC,IAAMI,MAAM,GAAGL,aAAa,CAACC,CAAC,CAAC;MAC/B,IAAII,MAAM,EAAE;QACVI,SAAS,CAACJ,MAAM,CAAC;MACnB;IACF;IAEAZ,QAAQ,CAACa,SAAS,CAACI,eAAe,CAAC;IACnC,OAAO,YAAM;MACXjB,QAAQ,CAACkB,WAAW,CAACD,eAAe,CAAC;IACvC,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOL,MAAM;AACf"}