{"version":3,"file":"useDateInput.js","names":["React","useBooleanState","useGlobalEventListener","useDOM","useDateInput","maxElement","refs","autoFocus","disabled","elementsConfig","onChange","onInternalValueChange","getInternalValue","value","document","open","openCalendar","setTrue","closeCalendar","setFalse","rootRef","useRef","calendarRef","useState","internalValue","setInternalValue","focusedElement","setFocusedElement","window","removeFocusFromField","useCallback","getSelection","removeAllRanges","handleClickOutside","e","current","contains","target","selectFirst","capture","useEffect","range","createRange","element","focus","selectNodeContents","selection","addRange","clear","undefined","handleFieldEnter","handleKeyDown","_value","config","test","key","length","slice","currentValue","Number","String","min","max","padStart","shiftKey","preventDefault"],"sources":["../../src/hooks/useDateInput.ts"],"sourcesContent":["import * as React from 'react';\nimport { useBooleanState } from './useBooleanState';\nimport { useGlobalEventListener } from './useGlobalEventListener';\nimport { useDOM } from '../lib/dom';\n\nexport interface UseDateInputDependencies<T, D> {\n  maxElement: number;\n  refs: Array<React.RefObject<T>>;\n  autoFocus?: boolean;\n  disabled?: boolean;\n  value?: D;\n  elementsConfig(index: number): {\n    length: number;\n    min: number;\n    max: number;\n  };\n  onInternalValueChange(value: string[]): void;\n  getInternalValue(value?: D | undefined): string[];\n  onChange?(value?: D | undefined): void;\n}\n\nexport function useDateInput<T extends HTMLElement, D>({\n  maxElement,\n  refs,\n  autoFocus,\n  disabled,\n  elementsConfig,\n  onChange,\n  onInternalValueChange,\n  getInternalValue,\n  value,\n}: UseDateInputDependencies<T, D>) {\n  const { document } = useDOM();\n  const { value: open, setTrue: openCalendar, setFalse: closeCalendar } = useBooleanState(false);\n  const rootRef = React.useRef<HTMLDivElement>(null);\n  const calendarRef = React.useRef<HTMLDivElement>(null);\n  const [internalValue, setInternalValue] = React.useState<string[]>([]);\n  const [focusedElement, setFocusedElement] = React.useState<number | null>(null);\n  const { window } = useDOM();\n\n  const removeFocusFromField = React.useCallback(() => {\n    if (open) {\n      setFocusedElement(null);\n      closeCalendar();\n      window!.getSelection()?.removeAllRanges();\n      setInternalValue(getInternalValue(value));\n    }\n  }, [closeCalendar, getInternalValue, open, value, window]);\n\n  const handleClickOutside = React.useCallback(\n    (e: MouseEvent) => {\n      if (\n        !rootRef.current?.contains(e.target as Node | null) &&\n        !calendarRef.current?.contains(e.target as Node | null)\n      ) {\n        removeFocusFromField();\n      }\n    },\n    [removeFocusFromField],\n  );\n\n  const selectFirst = React.useCallback(() => {\n    setFocusedElement(0);\n  }, []);\n\n  useGlobalEventListener(document, 'click', handleClickOutside, {\n    capture: true,\n  });\n\n  React.useEffect(() => {\n    setInternalValue(getInternalValue(value));\n  }, [getInternalValue, value]);\n\n  React.useEffect(() => {\n    if (autoFocus) {\n      selectFirst();\n    }\n  }, [autoFocus, selectFirst]);\n\n  React.useEffect(() => {\n    if (disabled || focusedElement === null) {\n      return;\n    }\n\n    const range = window!.document.createRange();\n\n    let element = refs[focusedElement].current;\n\n    if (element) {\n      element.focus();\n      openCalendar();\n      range.selectNodeContents(element as Node);\n\n      const selection = window!.getSelection();\n      selection?.removeAllRanges();\n      selection?.addRange(range);\n    }\n  }, [disabled, focusedElement, openCalendar, refs, window]);\n\n  const clear = React.useCallback(() => {\n    onChange?.(undefined);\n    selectFirst();\n  }, [onChange, selectFirst]);\n\n  const handleFieldEnter = React.useCallback(() => {\n    if (!open) {\n      selectFirst();\n    }\n  }, [open, selectFirst]);\n\n  const handleKeyDown = React.useCallback(\n    (e: React.KeyboardEvent<HTMLSpanElement>) => {\n      if (focusedElement === null) {\n        return;\n      }\n\n      const _value = [...internalValue];\n      const config = elementsConfig(focusedElement);\n\n      if (/^\\d+$/.test(e.key)) {\n        if (_value[focusedElement].length >= config.length) {\n          _value[focusedElement] = e.key;\n        } else {\n          _value[focusedElement] += e.key;\n          if (_value[focusedElement].length >= config.length && focusedElement < maxElement) {\n            setFocusedElement(focusedElement + 1);\n          }\n        }\n      } else if (e.key === 'Backspace') {\n        if (!_value[focusedElement]) {\n          setFocusedElement(focusedElement <= 0 ? maxElement : focusedElement - 1);\n        } else {\n          _value[focusedElement] = _value[focusedElement].slice(0, -1);\n        }\n      } else if (e.key === 'ArrowDown' || e.key === 'Down') {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue <= config.min ? config.max : currentValue - 1,\n        ).padStart(config.length, '0');\n      } else if (e.key === 'ArrowUp' || e.key === 'Up') {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue >= config.max ? config.min : currentValue + 1,\n        ).padStart(config.length, '0');\n      } else if (\n        e.key === 'Enter' ||\n        (e.key === 'Tab' && focusedElement === maxElement) ||\n        (e.key === 'Tab' && e.shiftKey && focusedElement === 0)\n      ) {\n        removeFocusFromField();\n        return;\n      } else if (e.key === 'ArrowLeft' || e.key === 'Left' || (e.key === 'Tab' && e.shiftKey)) {\n        setFocusedElement(focusedElement <= 0 ? maxElement : focusedElement - 1);\n      } else if (e.key === 'ArrowRight' || e.key === 'Right' || e.key === 'Tab') {\n        setFocusedElement(focusedElement >= maxElement ? 0 : focusedElement + 1);\n      } else if (e.key === 'Delete' || e.key === 'Del') {\n        _value[focusedElement] = '';\n      } else {\n        return;\n      }\n\n      e.preventDefault();\n      setInternalValue(_value);\n      onInternalValueChange(_value);\n    },\n    [\n      elementsConfig,\n      focusedElement,\n      internalValue,\n      maxElement,\n      onInternalValueChange,\n      removeFocusFromField,\n    ],\n  );\n\n  return {\n    rootRef,\n    calendarRef,\n    open,\n    openCalendar,\n    closeCalendar,\n    internalValue,\n    focusedElement,\n    setFocusedElement,\n    handleKeyDown,\n    clear,\n    handleFieldEnter,\n    removeFocusFromField,\n  };\n}\n"],"mappings":"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"}