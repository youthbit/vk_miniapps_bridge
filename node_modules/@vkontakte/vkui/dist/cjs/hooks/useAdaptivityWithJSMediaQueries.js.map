{"version":3,"file":"useAdaptivityWithJSMediaQueries.js","names":["useAdaptivityWithJSMediaQueries","canUseDOM","console","error","React","useContext","AdaptivityContext","viewWidthContext","viewWidth","viewHeightContext","viewHeight","sizeXContext","sizeX","sizeYContext","sizeY","hasPointerContext","hasPointer","hasHoverContext","hasHover","platform","usePlatform","mediaQueries","useMediaQueries","useState","getOrDefault","getViewWidthByMediaQueries","getViewHeightByMediaQueries","viewWidthLocal","viewHeightLocal","setViewSizeLocal","adaptivityProps","useMemo","hasPointerLib","hasHoverLib","getSizeX","getSizeY","isDesktop","tryToCheckIsDesktop","useEffect","handleMediaQuery","prevSizeLocal","newViewWidthLocal","newViewHeightLocal","prevViewWidthLocal","prevViewHeightLocal","desktopPlus","tablet","smallTablet","mobile","forEach","matchMediaListener","matchMediaListAddListener","mediumHeight","mobileLandscapeHeight","matchMediaListRemoveListener"],"sources":["../../../src/hooks/useAdaptivityWithJSMediaQueries.ts"],"sourcesContent":["import * as React from 'react';\nimport { canUseDOM, hasMouse as hasPointerLib, hasHover as hasHoverLib } from '@vkontakte/vkjs';\nimport {\n  AdaptivityContext,\n  type AdaptivityProps as BaseAdaptivityProps,\n} from '../components/AdaptivityProvider/AdaptivityContext';\nimport { getOrDefault } from '../helpers/getOrDefault';\nimport {\n  getViewWidthByMediaQueries,\n  getViewHeightByMediaQueries,\n  getSizeX,\n  getSizeY,\n  tryToCheckIsDesktop,\n} from '../lib/adaptivity';\nimport { useMediaQueries } from './useMediaQueries';\nimport { usePlatform } from './usePlatform';\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from '../lib/matchMedia';\n\nexport interface UseAdaptivityWithJSMediaQueries extends Required<BaseAdaptivityProps> {\n  isDesktop: boolean;\n}\n\n/**\n * Высчитывает и возвращает параметры адаптивности при изменении вьюпорта.\n *\n * Берёт в приоритет значения из `AdaptivityContext`.\n *\n * > ⚠ SSR\n * >\n * > Во избежания ошибок при гидратации, не используйте данный хук, если есть вероятность, что компонент будет отрендерен\n * > на стороне сервера.\n * >\n * > Лучше всего использовать для всплывающих окон, т.к. они вызываются только после загрузки\n * > страницы либо пользователем, либо программно.\n */\nexport const useAdaptivityWithJSMediaQueries = (): UseAdaptivityWithJSMediaQueries => {\n  if (!canUseDOM) {\n    console.error(`[useAdaptivityWithJSMediaQueries] Похоже, вы пытаетесь использовать хук вне браузера.\n\nПостарайтесь этого избегать, чтобы не было ошибок при гидратации: при SSR нет информации о размерах экрана.\n\nИспользуйте CSS Media Query или библиотеку по типу https://github.com/artsy/fresnel.`);\n  }\n\n  const {\n    viewWidth: viewWidthContext,\n    viewHeight: viewHeightContext,\n    sizeX: sizeXContext,\n    sizeY: sizeYContext,\n    hasPointer: hasPointerContext,\n    hasHover: hasHoverContext,\n  } = React.useContext(AdaptivityContext);\n\n  const platform = usePlatform();\n  const mediaQueries = useMediaQueries();\n\n  const [[viewWidthLocal, viewHeightLocal], setViewSizeLocal] = React.useState(() => [\n    getOrDefault(viewWidthContext, getViewWidthByMediaQueries(mediaQueries)),\n    getOrDefault(viewHeightContext, getViewHeightByMediaQueries(mediaQueries)),\n  ]);\n\n  const adaptivityProps = React.useMemo(() => {\n    const hasPointer = getOrDefault(hasPointerContext, hasPointerLib);\n    const hasHover = getOrDefault(hasHoverContext, hasHoverLib);\n    const viewWidth = getOrDefault(viewWidthContext, viewWidthLocal);\n    const viewHeight = getOrDefault(viewHeightContext, viewHeightLocal);\n    const sizeX = getOrDefault(sizeXContext, getSizeX(viewWidth));\n    const sizeY = getOrDefault(sizeYContext, getSizeY(viewWidth, viewHeight, hasPointer));\n    const isDesktop = tryToCheckIsDesktop(viewWidth, viewHeight, hasPointer, platform);\n\n    return {\n      viewWidth,\n      viewHeight,\n      sizeX,\n      sizeY,\n      hasPointer,\n      hasHover,\n      isDesktop,\n    };\n  }, [\n    viewWidthLocal,\n    viewHeightLocal,\n    viewWidthContext,\n    viewHeightContext,\n    sizeXContext,\n    sizeYContext,\n    hasPointerContext,\n    hasHoverContext,\n    platform,\n  ]);\n\n  React.useEffect(() => {\n    const handleMediaQuery = () => {\n      setViewSizeLocal((prevSizeLocal) => {\n        const newViewWidthLocal = getOrDefault(\n          viewWidthContext,\n          getViewWidthByMediaQueries(mediaQueries),\n        );\n        const newViewHeightLocal = getOrDefault(\n          viewHeightContext,\n          getViewHeightByMediaQueries(mediaQueries),\n        );\n\n        const [prevViewWidthLocal, prevViewHeightLocal] = prevSizeLocal;\n\n        if (\n          prevViewWidthLocal !== newViewWidthLocal ||\n          prevViewHeightLocal !== newViewHeightLocal\n        ) {\n          return [newViewWidthLocal, newViewHeightLocal];\n        }\n\n        return prevSizeLocal;\n      });\n    };\n\n    if (!viewWidthContext) {\n      [\n        mediaQueries.desktopPlus,\n        mediaQueries.tablet,\n        mediaQueries.smallTablet,\n        mediaQueries.mobile,\n      ].forEach((matchMediaListener) =>\n        matchMediaListAddListener(matchMediaListener, handleMediaQuery),\n      );\n    }\n\n    if (!viewHeightContext) {\n      [mediaQueries.mediumHeight, mediaQueries.mobileLandscapeHeight].forEach(\n        (matchMediaListener) => matchMediaListAddListener(matchMediaListener, handleMediaQuery),\n      );\n    }\n\n    return () => {\n      [\n        mediaQueries.desktopPlus,\n        mediaQueries.tablet,\n        mediaQueries.smallTablet,\n        mediaQueries.mobile,\n        mediaQueries.mediumHeight,\n        mediaQueries.mobileLandscapeHeight,\n      ].forEach((matchMediaListener) =>\n        matchMediaListRemoveListener(matchMediaListener, handleMediaQuery),\n      );\n    };\n  }, [mediaQueries, viewWidthContext, viewHeightContext]);\n\n  return adaptivityProps;\n};\n"],"mappings":"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"}