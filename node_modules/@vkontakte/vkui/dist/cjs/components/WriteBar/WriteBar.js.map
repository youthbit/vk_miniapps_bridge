{"version":3,"file":"WriteBar.js","names":["WriteBar","className","style","before","inlineAfter","after","getRootRef","getRef","onHeightChange","shadow","defaultValue","restProps","platform","usePlatform","useEnsuredControl","value","onChange","textareaRef","useExternRef","currentScrollHeight","React","useRef","resize","useCallback","textareaEl","current","offsetParent","height","scrollHeight","useEffect","classNames","Platform","IOS","hasReactNode"],"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Headline } from '../Typography/Headline/Headline';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { Platform } from '../../lib/platform';\nimport { HasRef, HasRootRef } from '../../types';\nimport { useEnsuredControl } from '../../hooks/useEnsuredControl';\nimport styles from './WriteBar.module.css';\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n  /**\n   * Добавляет тень вокруг поля ввода\n   */\n  shadow?: boolean;\n\n  children?: never;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar = ({\n  className,\n  style,\n  before,\n  inlineAfter,\n  after,\n  getRootRef,\n  getRef,\n  onHeightChange,\n  shadow = false,\n  defaultValue,\n  ...restProps\n}: WriteBarProps) => {\n  const platform = usePlatform();\n\n  const [value, onChange] = useEnsuredControl({\n    defaultValue,\n    ...restProps,\n  });\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = '';\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (textareaEl.scrollHeight !== currentScrollHeight.current && onHeightChange) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  React.useEffect(resize, [resize, value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      className={classNames(\n        styles['WriteBar'],\n        platform === Platform.IOS && styles['WriteBar--ios'],\n        shadow && styles['WriteBar--shadow'],\n        className,\n      )}\n      style={style}\n    >\n      <div className={styles['WriteBar__form']}>\n        {hasReactNode(before) && <div className={styles['WriteBar__before']}>{before}</div>}\n\n        <div className={styles['WriteBar__formIn']}>\n          <Headline\n            {...restProps}\n            Component=\"textarea\"\n            className={styles['WriteBar__textarea']}\n            onChange={onChange}\n            getRootRef={textareaRef}\n            value={value}\n          />\n          {hasReactNode(inlineAfter) && (\n            <div className={styles['WriteBar__inlineAfter']}>{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div className={styles['WriteBar__after']}>{after}</div>}\n      </div>\n    </div>\n  );\n};\n"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAkE;AA+BlE;AACA;AACA;AACO,IAAMA,QAAQ,GAAG,SAAXA,QAAQ,OAYA;EAAA,IAXnBC,SAAS,QAATA,SAAS;IACTC,KAAK,QAALA,KAAK;IACLC,MAAM,QAANA,MAAM;IACNC,WAAW,QAAXA,WAAW;IACXC,KAAK,QAALA,KAAK;IACLC,UAAU,QAAVA,UAAU;IACVC,MAAM,QAANA,MAAM;IACNC,cAAc,QAAdA,cAAc;IAAA,mBACdC,MAAM;IAANA,MAAM,4BAAG,KAAK;IACdC,YAAY,QAAZA,YAAY;IACTC,SAAS;EAEZ,IAAMC,QAAQ,GAAG,IAAAC,wBAAW,GAAE;EAE9B,yBAA0B,IAAAC,qCAAiB;MACzCJ,YAAY,EAAZA;IAAY,GACTC,SAAS,EACZ;IAAA;IAHKI,KAAK;IAAEC,QAAQ;EAKtB,IAAMC,WAAW,GAAG,IAAAC,0BAAY,EAACX,MAAM,CAAC;EACxC,IAAMY,mBAAmB,GAAGC,KAAK,CAACC,MAAM,EAAU;EAElD,IAAMC,MAAM,GAAGF,KAAK,CAACG,WAAW,CAAC,YAAM;IACrC,IAAMC,UAAU,GAAGP,WAAW,CAACQ,OAAO;IACtC,IAAI,CAACD,UAAU,EAAE;MACf;IACF;IAEA,IAAIA,UAAU,CAACE,YAAY,EAAE;MAC3BF,UAAU,CAACtB,KAAK,CAACyB,MAAM,GAAG,EAAE;MAC5BH,UAAU,CAACtB,KAAK,CAACyB,MAAM,aAAMH,UAAU,CAACI,YAAY,OAAI;MAExD,IAAIJ,UAAU,CAACI,YAAY,KAAKT,mBAAmB,CAACM,OAAO,IAAIjB,cAAc,EAAE;QAC7EA,cAAc,EAAE;QAChBW,mBAAmB,CAACM,OAAO,GAAGD,UAAU,CAACI,YAAY;MACvD;IACF;EACF,CAAC,EAAE,CAACpB,cAAc,EAAES,WAAW,CAAC,CAAC;EAEjCG,KAAK,CAACS,SAAS,CAACP,MAAM,EAAE,CAACA,MAAM,EAAEP,KAAK,CAAC,CAAC;EAExC,oBACE;IACE,GAAG,EAAET,UAAW;IAChB,SAAS,EAAE,IAAAwB,gBAAU,kBAEnBlB,QAAQ,KAAKmB,kBAAQ,CAACC,GAAG,uBAA2B,EACpDvB,MAAM,0BAA8B,EACpCR,SAAS,CACT;IACF,KAAK,EAAEC;EAAM,gBAEb;IAAK,SAAS;EAA2B,GACtC,IAAA+B,kBAAY,EAAC9B,MAAM,CAAC,iBAAI;IAAK,SAAS;EAA6B,GAAEA,MAAM,CAAO,eAEnF;IAAK,SAAS;EAA6B,gBACzC,oBAAC,kBAAQ,6BACHQ,SAAS;IACb,SAAS,EAAC,UAAU;IACpB,SAAS,0BAA+B;IACxC,QAAQ,EAAEK,QAAS;IACnB,UAAU,EAAEC,WAAY;IACxB,KAAK,EAAEF;EAAM,GACb,EACD,IAAAkB,kBAAY,EAAC7B,WAAW,CAAC,iBACxB;IAAK,SAAS;EAAkC,GAAEA,WAAW,CAC9D,CACG,EAEL,IAAA6B,kBAAY,EAAC5B,KAAK,CAAC,iBAAI;IAAK,SAAS;EAA4B,GAAEA,KAAK,CAAO,CAC5E,CACF;AAEV,CAAC;AAAC"}