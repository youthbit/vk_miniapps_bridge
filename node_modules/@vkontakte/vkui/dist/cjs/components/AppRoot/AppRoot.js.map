{"version":3,"file":"AppRoot.js","names":["INSET_CUSTOM_PROPERTY_PREFIX","AppRoot","children","mode","scroll","portalRoot","portalRootProp","disablePortal","className","props","isKeyboardInputActive","useKeyboardInputTracker","rootRef","React","useRef","useState","setPortalRoot","useDOM","document","insets","useInsets","appearance","useAppearance","useAdaptivity","hasPointer","sizeX","useIsomorphicLayoutEffect","portal","isRefObject","current","createElement","body","appendChild","parentElement","removeChild","noop","parent","classList","add","remove","documentElement","undefined","key","hasOwnProperty","inset","style","setProperty","removeProperty","getSizeXClassName","container","ScrollController","useMemo","ElementScrollController","GlobalScrollController","content","appRoot","embedded","keyboardInput","classNames"],"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { AppRootContext } from './AppRootContext';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { ElementScrollController, GlobalScrollController } from './ScrollContext';\nimport { useKeyboardInputTracker } from '../../hooks/useKeyboardInputTracker';\nimport { useInsets } from '../../hooks/useInsets';\nimport { Insets } from '@vkontakte/vk-bridge';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAppearance } from '../../hooks/useAppearance';\nimport { isRefObject } from '../../lib/isRefObject';\nimport { getSizeXClassName } from '../../helpers/getSizeXClassName';\nimport styles from './AppRoot.module.css';\n\nconst INSET_CUSTOM_PROPERTY_PREFIX = `--vkui_internal--safe_area_inset_`;\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends React.HTMLAttributes<HTMLDivElement> {\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  scroll?: 'global' | 'contain';\n  /**\n   * Кастомный root-элемент портала\n   */\n  portalRoot?: HTMLElement | React.RefObject<HTMLElement> | null;\n  /** Disable portal for components */\n  disablePortal?: boolean;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\nexport const AppRoot = ({\n  children,\n  mode = 'full',\n  scroll = 'global',\n  portalRoot: portalRootProp = null,\n  disablePortal,\n  className,\n  ...props\n}: AppRootProps) => {\n  const isKeyboardInputActive = useKeyboardInputTracker();\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [portalRoot, setPortalRoot] = React.useState<HTMLElement | null>(null);\n  const { document } = useDOM();\n  const insets = useInsets();\n  const appearance = useAppearance();\n\n  const { hasPointer, sizeX } = useAdaptivity();\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    let portal: HTMLElement | null = null;\n    if (portalRootProp) {\n      if (isRefObject(portalRootProp)) {\n        portal = portalRootProp.current;\n      } else {\n        portal = portalRootProp;\n      }\n    }\n    if (!portal) {\n      portal = document!.createElement('div');\n      document!.body.appendChild(portal);\n    }\n    setPortalRoot(portal);\n    return () => {\n      portal?.parentElement?.removeChild(portal);\n    };\n  }, [portalRootProp]);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode !== 'embedded') {\n      return noop;\n    }\n\n    const parent = rootRef.current?.parentElement;\n    parent?.classList.add('vkui__root--embedded');\n\n    return () => {\n      parent?.classList.remove('vkui__root--embedded');\n    };\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      document!.documentElement.classList.add('vkui');\n\n      return () => {\n        document!.documentElement.classList.remove('vkui');\n      };\n    }\n\n    return undefined;\n  }, [document, mode]);\n\n  // setup insets\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || !rootRef.current?.parentElement) {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n\n    let key: keyof Insets;\n    for (key in insets) {\n      if (insets.hasOwnProperty(key) && typeof insets[key] === 'number') {\n        const inset = insets[key];\n        parent.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n        portalRoot &&\n          portalRoot.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n      }\n    }\n\n    return () => {\n      let key: keyof Insets;\n      for (key in insets) {\n        if (insets.hasOwnProperty(key)) {\n          parent.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n          portalRoot && portalRoot.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n        }\n      }\n    };\n  }, [insets, portalRoot]);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n    const className = getSizeXClassName('vkui', sizeX);\n    const container = mode === 'embedded' ? rootRef.current?.parentElement : document!.body;\n    container?.classList.add(className);\n    return () => container?.classList.remove(className);\n  }, [sizeX]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode !== 'full' || appearance === undefined) {\n      return noop;\n    }\n    document!.documentElement.style.setProperty('color-scheme', appearance);\n\n    return () => document!.documentElement.style.removeProperty('color-scheme');\n  }, [appearance]);\n\n  const ScrollController = React.useMemo(\n    () => (scroll === 'contain' ? ElementScrollController : GlobalScrollController),\n    [scroll],\n  );\n\n  const content = (\n    <AppRootContext.Provider\n      value={{\n        appRoot: rootRef,\n        portalRoot,\n        embedded: mode === 'embedded',\n        keyboardInput: isKeyboardInputActive,\n        mode,\n        disablePortal,\n      }}\n    >\n      <ScrollController elRef={rootRef}>\n        <IconSettingsProvider classPrefix=\"vkui\">{children}</IconSettingsProvider>\n      </ScrollController>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? (\n    content\n  ) : (\n    <div\n      ref={rootRef}\n      className={classNames(\n        styles['AppRoot'],\n        hasPointer === undefined\n          ? styles['AppRoot--pointer-none']\n          : !hasPointer && styles['AppRoot--pointer-has-not'],\n        className,\n      )}\n      {...props}\n    >\n      {content}\n    </div>\n  );\n};\n"],"mappings":"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"}