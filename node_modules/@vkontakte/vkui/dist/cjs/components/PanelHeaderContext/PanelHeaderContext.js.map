{"version":3,"file":"PanelHeaderContext.js","names":["PanelHeaderContext","children","onClose","opened","className","restProps","useDOM","document","platform","usePlatform","React","useState","visible","setVisible","closing","useAdaptivity","sizeX","elementRef","useRef","useIsomorphicLayoutEffect","useScrollLock","Platform","VKCOM","useGlobalEventListener","event","current","contains","target","stopPropagation","capture","onAnimationEnd","animationFallback","useTimeout","useEffect","set","clear","classNames","IOS","getSizeXClassName","undefined"],"sources":["../../../../src/components/PanelHeaderContext/PanelHeaderContext.tsx"],"sourcesContent":["import * as React from 'react';\nimport { FixedLayout } from '../FixedLayout/FixedLayout';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useDOM } from '../../lib/dom';\nimport { Platform } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { getSizeXClassName } from '../../helpers/getSizeXClassName';\nimport styles from './PanelHeaderContext.module.css';\n\nexport interface PanelHeaderContextProps extends React.HTMLAttributes<HTMLDivElement> {\n  opened: boolean;\n  onClose: VoidFunction;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PanelHeaderContext\n */\nexport const PanelHeaderContext = ({\n  children,\n  onClose,\n  opened = false,\n  className,\n  ...restProps\n}: PanelHeaderContextProps) => {\n  const { document } = useDOM();\n  const platform = usePlatform();\n  const [visible, setVisible] = React.useState(opened);\n  const closing = visible && !opened;\n  const { sizeX } = useAdaptivity();\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    opened && setVisible(true);\n  }, [opened]);\n\n  useScrollLock(platform !== Platform.VKCOM && opened);\n\n  // start closing on outer click\n  useGlobalEventListener(\n    document,\n    'click',\n    opened &&\n      !closing &&\n      ((event) => {\n        if (elementRef.current && !elementRef.current.contains(event.target as Node)) {\n          event.stopPropagation();\n          onClose();\n        }\n      }),\n    { capture: true },\n  );\n\n  // fallback onAnimationEnd when animationend not supported\n  const onAnimationEnd = () => setVisible(false);\n  const animationFallback = useTimeout(onAnimationEnd, 200);\n  React.useEffect(\n    () => (closing ? animationFallback.set() : animationFallback.clear()),\n    [animationFallback, closing],\n  );\n\n  return (\n    <FixedLayout\n      {...restProps}\n      className={classNames(\n        styles['PanelHeaderContext'],\n        platform === Platform.IOS && styles['PanelHeaderContext--ios'],\n        opened && styles['PanelHeaderContext--opened'],\n        closing && styles['PanelHeaderContext--closing'],\n        getSizeXClassName(styles['PanelHeaderContext'], sizeX),\n        styles['PanelHeaderContext--rounded'],\n        className,\n      )}\n      vertical=\"top\"\n    >\n      {visible && (\n        <div\n          onClick={(event) => {\n            event.stopPropagation();\n            onClose();\n          }}\n          className={styles['PanelHeaderContext__fade']}\n        />\n      )}\n      <div\n        className={styles['PanelHeaderContext__in']}\n        ref={elementRef}\n        onAnimationEnd={closing ? onAnimationEnd : undefined}\n      >\n        <div className={styles['PanelHeaderContext__content']}>{visible && children}</div>\n      </div>\n    </FixedLayout>\n  );\n};\n"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAoE;AAQpE;AACA;AACA;AACO,IAAMA,kBAAkB,GAAG,SAArBA,kBAAkB,OAMA;EAAA,IAL7BC,QAAQ,QAARA,QAAQ;IACRC,OAAO,QAAPA,OAAO;IAAA,mBACPC,MAAM;IAANA,MAAM,4BAAG,KAAK;IACdC,SAAS,QAATA,SAAS;IACNC,SAAS;EAEZ,cAAqB,IAAAC,WAAM,GAAE;IAArBC,QAAQ,WAARA,QAAQ;EAChB,IAAMC,QAAQ,GAAG,IAAAC,wBAAW,GAAE;EAC9B,sBAA8BC,KAAK,CAACC,QAAQ,CAACR,MAAM,CAAC;IAAA;IAA7CS,OAAO;IAAEC,UAAU;EAC1B,IAAMC,OAAO,GAAGF,OAAO,IAAI,CAACT,MAAM;EAClC,qBAAkB,IAAAY,6BAAa,GAAE;IAAzBC,KAAK,kBAALA,KAAK;EACb,IAAMC,UAAU,GAAGP,KAAK,CAACQ,MAAM,CAAiB,IAAI,CAAC;EAErD,IAAAC,oDAAyB,EAAC,YAAM;IAC9BhB,MAAM,IAAIU,UAAU,CAAC,IAAI,CAAC;EAC5B,CAAC,EAAE,CAACV,MAAM,CAAC,CAAC;EAEZ,IAAAiB,4BAAa,EAACZ,QAAQ,KAAKa,kBAAQ,CAACC,KAAK,IAAInB,MAAM,CAAC;;EAEpD;EACA,IAAAoB,8CAAsB,EACpBhB,QAAQ,EACR,OAAO,EACPJ,MAAM,IACJ,CAACW,OAAO,IACP,UAACU,KAAK,EAAK;IACV,IAAIP,UAAU,CAACQ,OAAO,IAAI,CAACR,UAAU,CAACQ,OAAO,CAACC,QAAQ,CAACF,KAAK,CAACG,MAAM,CAAS,EAAE;MAC5EH,KAAK,CAACI,eAAe,EAAE;MACvB1B,OAAO,EAAE;IACX;EACF,CAAE,EACJ;IAAE2B,OAAO,EAAE;EAAK,CAAC,CAClB;;EAED;EACA,IAAMC,cAAc,GAAG,SAAjBA,cAAc;IAAA,OAASjB,UAAU,CAAC,KAAK,CAAC;EAAA;EAC9C,IAAMkB,iBAAiB,GAAG,IAAAC,sBAAU,EAACF,cAAc,EAAE,GAAG,CAAC;EACzDpB,KAAK,CAACuB,SAAS,CACb;IAAA,OAAOnB,OAAO,GAAGiB,iBAAiB,CAACG,GAAG,EAAE,GAAGH,iBAAiB,CAACI,KAAK,EAAE;EAAA,CAAC,EACrE,CAACJ,iBAAiB,EAAEjB,OAAO,CAAC,CAC7B;EAED,oBACE,oBAAC,wBAAW,6BACNT,SAAS;IACb,SAAS,EAAE,IAAA+B,gBAAU,4BAEnB5B,QAAQ,KAAKa,kBAAQ,CAACgB,GAAG,iCAAqC,EAC9DlC,MAAM,oCAAwC,EAC9CW,OAAO,qCAAyC,EAChD,IAAAwB,oCAAiB,4BAA+BtB,KAAK,CAAC,qCAEtDZ,SAAS,CACT;IACF,QAAQ,EAAC;EAAK,IAEbQ,OAAO,iBACN;IACE,OAAO,EAAE,iBAACY,KAAK,EAAK;MAClBA,KAAK,CAACI,eAAe,EAAE;MACvB1B,OAAO,EAAE;IACX,CAAE;IACF,SAAS;EAAqC,EAEjD,eACD;IACE,SAAS,8BAAmC;IAC5C,GAAG,EAAEe,UAAW;IAChB,cAAc,EAAEH,OAAO,GAAGgB,cAAc,GAAGS;EAAU,gBAErD;IAAK,SAAS;EAAwC,GAAE3B,OAAO,IAAIX,QAAQ,CAAO,CAC9E,CACM;AAElB,CAAC;AAAC"}