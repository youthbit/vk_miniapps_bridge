{"version":3,"file":"Gallery.js","names":["Gallery","initialSlideIndex","children","timeout","onChange","bullets","props","React","useState","localSlideIndex","setSlideIndex","isControlled","slideIndex","isDraggable","Boolean","slides","useMemo","Children","toArray","filter","item","childCount","length","handleChange","useCallback","current","autoplay","useTimeout","useEffect","set","clear","safeSlideIndex","clamp"],"sources":["../../../../src/components/Gallery/Gallery.tsx"],"sourcesContent":["import * as React from 'react';\nimport { clamp } from '../../helpers/math';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { BaseGallery } from '../BaseGallery/BaseGallery';\nimport { BaseGalleryProps } from '../BaseGallery/types';\n\nexport interface GalleryProps extends BaseGalleryProps {\n  initialSlideIndex?: number;\n  timeout?: number;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  ...props\n}: GalleryProps) => {\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === 'number';\n  const slideIndex = isControlled ? props.slideIndex ?? 0 : localSlideIndex;\n  const isDraggable = !isControlled || Boolean(onChange);\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children],\n  );\n  const childCount = slides.length;\n\n  const handleChange: GalleryProps['onChange'] = React.useCallback(\n    (current: number) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex],\n  );\n\n  const autoplay = useTimeout(() => handleChange((slideIndex + 1) % childCount), timeout);\n  React.useEffect(\n    () => (timeout ? autoplay.set() : autoplay.clear()),\n    [timeout, slideIndex, autoplay],\n  );\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  return (\n    <BaseGallery\n      isDraggable={isDraggable}\n      {...props}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </BaseGallery>\n  );\n};\n"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAyD;AAQzD;AACA;AACA;AACO,IAAMA,OAAO,GAAG,SAAVA,OAAO,OAOA;EAAA;EAAA,iCANlBC,iBAAiB;IAAjBA,iBAAiB,sCAAG,CAAC;IACrBC,QAAQ,QAARA,QAAQ;IAAA,oBACRC,OAAO;IAAPA,OAAO,6BAAG,CAAC;IACXC,QAAQ,QAARA,QAAQ;IACRC,OAAO,QAAPA,OAAO;IACJC,KAAK;EAER,sBAAyCC,KAAK,CAACC,QAAQ,CAACP,iBAAiB,CAAC;IAAA;IAAnEQ,eAAe;IAAEC,aAAa;EACrC,IAAMC,YAAY,GAAG,OAAOL,KAAK,CAACM,UAAU,KAAK,QAAQ;EACzD,IAAMA,UAAU,GAAGD,YAAY,wBAAGL,KAAK,CAACM,UAAU,iEAAI,CAAC,GAAGH,eAAe;EACzE,IAAMI,WAAW,GAAG,CAACF,YAAY,IAAIG,OAAO,CAACV,QAAQ,CAAC;EACtD,IAAMW,MAAM,GAAGR,KAAK,CAACS,OAAO,CAC1B;IAAA,OAAMT,KAAK,CAACU,QAAQ,CAACC,OAAO,CAAChB,QAAQ,CAAC,CAACiB,MAAM,CAAC,UAACC,IAAI;MAAA,OAAKN,OAAO,CAACM,IAAI,CAAC;IAAA,EAAC;EAAA,GACtE,CAAClB,QAAQ,CAAC,CACX;EACD,IAAMmB,UAAU,GAAGN,MAAM,CAACO,MAAM;EAEhC,IAAMC,YAAsC,GAAGhB,KAAK,CAACiB,WAAW,CAC9D,UAACC,OAAe,EAAK;IACnB,IAAIA,OAAO,KAAKb,UAAU,EAAE;MAC1B;IACF;IACA,CAACD,YAAY,IAAID,aAAa,CAACe,OAAO,CAAC;IACvCrB,QAAQ,IAAIA,QAAQ,CAACqB,OAAO,CAAC;EAC/B,CAAC,EACD,CAACd,YAAY,EAAEP,QAAQ,EAAEQ,UAAU,CAAC,CACrC;EAED,IAAMc,QAAQ,GAAG,IAAAC,sBAAU,EAAC;IAAA,OAAMJ,YAAY,CAAC,CAACX,UAAU,GAAG,CAAC,IAAIS,UAAU,CAAC;EAAA,GAAElB,OAAO,CAAC;EACvFI,KAAK,CAACqB,SAAS,CACb;IAAA,OAAOzB,OAAO,GAAGuB,QAAQ,CAACG,GAAG,EAAE,GAAGH,QAAQ,CAACI,KAAK,EAAE;EAAA,CAAC,EACnD,CAAC3B,OAAO,EAAES,UAAU,EAAEc,QAAQ,CAAC,CAChC;;EAED;EACA;EACA,IAAMK,cAAc,GAAGV,UAAU,GAAG,CAAC,GAAG,IAAAW,WAAK,EAACpB,UAAU,EAAE,CAAC,EAAES,UAAU,GAAG,CAAC,CAAC,GAAGT,UAAU;EACzF;EACAL,KAAK,CAACqB,SAAS,CAAC,YAAM;IACpB,IAAIxB,QAAQ,IAAI2B,cAAc,KAAKnB,UAAU,EAAE;MAC7CR,QAAQ,CAAC2B,cAAc,CAAC;IAC1B;IACArB,aAAa,CAACqB,cAAc,CAAC;EAC/B,CAAC,EAAE,CAAC3B,QAAQ,EAAE2B,cAAc,EAAEnB,UAAU,CAAC,CAAC;EAE1C,oBACE,oBAAC,wBAAW;IACV,WAAW,EAAEC;EAAY,GACrBP,KAAK;IACT,OAAO,EAAEe,UAAU,GAAG,CAAC,IAAIhB,OAAQ;IACnC,UAAU,EAAE0B,cAAe;IAC3B,QAAQ,EAAER;EAAa,IAEtBR,MAAM,CACK;AAElB,CAAC;AAAC"}