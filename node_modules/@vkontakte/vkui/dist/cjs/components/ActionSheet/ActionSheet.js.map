{"version":3,"file":"ActionSheet.js","names":["ActionSheet","children","className","header","text","style","iosCloseItem","popupDirection","popupOffsetDistance","restProps","platform","usePlatform","React","useState","closing","setClosing","onClose","_action","useRef","noop","afterClose","current","useAdaptivityWithJSMediaQueries","isDesktop","useScrollLock","timeout","Platform","IOS","fallbackTransitionFinish","useTimeout","useEffect","set","clear","onItemClick","useCallback","action","immediateAction","autoClose","event","persist","contextValue","useObjectMemo","DropdownComponent","ActionSheetDropdownDesktop","ActionSheetDropdown","dropdownProps","Object","assign","actionSheet","undefined"],"sources":["../../../../src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from 'react';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { Platform } from '../../lib/platform';\nimport { ActionSheetDropdownDesktop } from './ActionSheetDropdownDesktop';\nimport { ActionSheetDropdown } from './ActionSheetDropdown';\nimport { noop } from '@vkontakte/vkjs';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { SharedDropdownProps } from './types';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport styles from './ActionSheet.module.css';\n\nexport interface ActionSheetProps\n  extends Pick<SharedDropdownProps, 'toggleRef' | 'popupDirection' | 'popupOffsetDistance'>,\n    React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи.\n   */\n  onClose: VoidFunction;\n  /**\n   * Только iOS.\n   */\n  iosCloseItem: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupDirection = 'bottom',\n  popupOffsetDistance,\n  ...restProps\n}: ActionSheetProps) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose();\n    _action.current();\n    _action.current = noop;\n  };\n\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n\n  useScrollLock(!isDesktop);\n\n  let timeout = platform === Platform.IOS ? 300 : 200;\n\n  if (isDesktop) {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closing) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    (action, immediateAction, autoClose) => (event) => {\n      event.persist();\n      immediateAction && immediateAction(event);\n      if (autoClose) {\n        _action.current = () => action && action(event);\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    },\n    [],\n  );\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop ? ActionSheetDropdownDesktop : ActionSheetDropdown;\n\n  const dropdownProps = isDesktop\n    ? Object.assign(restProps, { popupOffsetDistance, popupDirection })\n    : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={closing}\n        timeout={timeout}\n        {...dropdownProps}\n        onClose={onClose}\n        className={isDesktop ? className : undefined}\n        style={isDesktop ? style : undefined}\n      >\n        {(header || text) && (\n          <header className={styles['ActionSheet__header']}>\n            {header && (\n              <Footnote weight=\"2\" className={styles['ActionSheet__title']}>\n                {header}\n              </Footnote>\n            )}\n            {text && <Footnote className={styles['ActionSheet__text']}>{text}</Footnote>}\n          </header>\n        )}\n        {children}\n        {platform === Platform.IOS && !isDesktop && iosCloseItem}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (isDesktop) {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"mappings":"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"}