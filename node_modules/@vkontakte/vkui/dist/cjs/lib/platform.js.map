{"version":3,"file":"platform.js","names":["Platform","PLATFORM_ALIAS","desktop_web","VKCOM","isPlatformAlias","platformAlias","getPlatformByQueryString","queryString","parsedQuery","querystring","parse","platformAliasByQuery","undefined","e","console","warn","platformByQueryString","canUseDOM","location","search","platform","browserInfo","computeBrowserInfo","system","IOS","ANDROID"],"sources":["../../../src/lib/platform.ts"],"sourcesContent":["import { BrowserInfo, computeBrowserInfo } from './browser';\nimport { querystring } from '@vkontakte/vkjs';\nimport { canUseDOM } from './dom';\n\nexport enum Platform {\n  ANDROID = 'android',\n  IOS = 'ios',\n  VKCOM = 'vkcom',\n}\n\nconst PLATFORM_ALIAS = {\n  desktop_web: Platform.VKCOM,\n};\n\nfunction isPlatformAlias(platformAlias: string): platformAlias is keyof typeof PLATFORM_ALIAS {\n  return platformAlias in PLATFORM_ALIAS;\n}\n\n/**\n * Значение, которое передаётся в качестве query-параметра при открытии VK Mini Apps\n * @see {@link https://dev.vk.com/mini-apps/development/launch-params#vk_platform vk_platform}\n */\nfunction getPlatformByQueryString(queryString: string): Platform | undefined {\n  try {\n    const parsedQuery = querystring.parse(queryString);\n    const platformAliasByQuery = parsedQuery['vk_platform'];\n\n    return typeof platformAliasByQuery === 'string' && isPlatformAlias(platformAliasByQuery)\n      ? PLATFORM_ALIAS[platformAliasByQuery]\n      : undefined;\n  } catch (e) {\n    console.warn(e);\n\n    return undefined;\n  }\n}\n\nconst platformByQueryString = canUseDOM ? getPlatformByQueryString(location.search) : undefined;\n\nexport type PlatformType = Platform.ANDROID | Platform.IOS | Platform.VKCOM | string;\n\nexport function platform(browserInfo?: BrowserInfo): PlatformType {\n  if (platformByQueryString) {\n    return platformByQueryString;\n  }\n\n  if (!browserInfo) {\n    browserInfo = computeBrowserInfo();\n  }\n\n  return browserInfo.system === 'ios' ? Platform.IOS : Platform.ANDROID;\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AAAkC,IAEtBA,QAAQ;AAAA;AAAA,WAARA,QAAQ;EAARA,QAAQ;EAARA,QAAQ;EAARA,QAAQ;AAAA,GAARA,QAAQ,wBAARA,QAAQ;AAMpB,IAAMC,cAAc,GAAG;EACrBC,WAAW,EAAEF,QAAQ,CAACG;AACxB,CAAC;AAED,SAASC,eAAe,CAACC,aAAqB,EAAgD;EAC5F,OAAOA,aAAa,IAAIJ,cAAc;AACxC;;AAEA;AACA;AACA;AACA;AACA,SAASK,wBAAwB,CAACC,WAAmB,EAAwB;EAC3E,IAAI;IACF,IAAMC,WAAW,GAAGC,iBAAW,CAACC,KAAK,CAACH,WAAW,CAAC;IAClD,IAAMI,oBAAoB,GAAGH,WAAW,CAAC,aAAa,CAAC;IAEvD,OAAO,OAAOG,oBAAoB,KAAK,QAAQ,IAAIP,eAAe,CAACO,oBAAoB,CAAC,GACpFV,cAAc,CAACU,oBAAoB,CAAC,GACpCC,SAAS;EACf,CAAC,CAAC,OAAOC,CAAC,EAAE;IACVC,OAAO,CAACC,IAAI,CAACF,CAAC,CAAC;IAEf,OAAOD,SAAS;EAClB;AACF;AAEA,IAAMI,qBAAqB,GAAGC,cAAS,GAAGX,wBAAwB,CAACY,QAAQ,CAACC,MAAM,CAAC,GAAGP,SAAS;AAIxF,SAASQ,QAAQ,CAACC,WAAyB,EAAgB;EAChE,IAAIL,qBAAqB,EAAE;IACzB,OAAOA,qBAAqB;EAC9B;EAEA,IAAI,CAACK,WAAW,EAAE;IAChBA,WAAW,GAAG,IAAAC,2BAAkB,GAAE;EACpC;EAEA,OAAOD,WAAW,CAACE,MAAM,KAAK,KAAK,GAAGvB,QAAQ,CAACwB,GAAG,GAAGxB,QAAQ,CAACyB,OAAO;AACvE"}