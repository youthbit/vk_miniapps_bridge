{"version":3,"file":"escape.js","names":["escapeReplacer","Replacer","unescapeReplacer","namedEntities","escape","input","replace","unescape","outOfBoundsChar","String","fromCharCode","ENCODE_REGEX","encodeHTMLEntities","entity","code","length","getCodePointAt","charCodeAt","DECODE_REGEX","decodeString","entities","secondChar","charAt","parseInt","substr","toLowerCase","fromCodePoint","numericUnicodeMap","slice","decodeHTMLEntitiesDeep","decodeHTMLEntities","correctType","Object","prototype","toString","apply","map","item","response","keys","forEach","decodeHTMLFullEntities","buildFullNamedEntities","fullNamedEntities"],"sources":["../../src/html/escape.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/quotes */\nimport { Replacer } from '../lib/replacer';\nimport { fromCodePoint, getCodePointAt, numericUnicodeMap } from '../lib/codepoints';\nimport { Dictionary } from '../types';\nimport { buildFullNamedEntities, fullNamedEntities } from './entity';\n\nconst escapeReplacer = /*#__PURE__*/ new Replacer({\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  \"'\": '&#39;',\n  '\"': '&quot;',\n});\n\nconst unescapeReplacer = /*#__PURE__*/ new Replacer({\n  '&amp;': '&',\n  '&#38;': '&',\n  '&lt;': '<',\n  '&#60;': '<',\n  '&gt;': '>',\n  '&#62;': '>',\n  '&apos;': \"'\",\n  '&#39;': \"'\",\n  '&quot;': '\"',\n  '&#34;': '\"',\n});\n\nconst namedEntities: Record<string, string> = {\n  'amp;': '&',\n  'lt;': '<',\n  'gt;': '>',\n  'quot;': '\"',\n  'apos;': `'`,\n};\n\n/**\n * Safely escape HTML entities such as `&`, `<`, `>`, `\"`, and `'`\n * @param {string} input\n */\nexport function escape(input: string): string {\n  return escapeReplacer.replace(input);\n}\n\n/**\n * Unescape HTML entities such as `&`, `<`, `>`, `\"`, and `'`\n * @param {string} input\n */\nexport function unescape(input: string): string {\n  return unescapeReplacer.replace(input);\n}\n\nexport const outOfBoundsChar = /*#__PURE__*/ String.fromCharCode(65533);\n\nconst ENCODE_REGEX =\n  /(?:[<>'\"&\\x01-\\x08\\x11-\\x15\\x17-\\x1F\\x7f-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])/g;\n\nexport function encodeHTMLEntities(input: string): string {\n  if (input == null) {\n    return '';\n  }\n\n  return input.replace(ENCODE_REGEX, (entity) => {\n    const code = entity.length > 1 ? getCodePointAt(entity, 0) : entity.charCodeAt(0);\n    return '&#' + String(code) + ';';\n  });\n}\n\nconst DECODE_REGEX = /&(?:#\\d+|#[xX][\\da-fA-F]+|[0-9a-zA-Z]+);?/g;\n\nfunction decodeString(input: string, entities: Record<string, string>): string {\n  if (typeof input !== 'string' || !input) {\n    return '';\n  }\n\n  return input.replace(DECODE_REGEX, (entity) => {\n    if (entity[1] === '#') {\n      // We need to have at least \"&#.\".\n      if (entity.length <= 3) {\n        return entity;\n      }\n\n      const secondChar = entity.charAt(2);\n      const code =\n        secondChar === 'x' || secondChar === 'X'\n          ? parseInt(entity.substr(3).toLowerCase(), 16)\n          : parseInt(entity.substr(2));\n\n      if (code >= 0x10ffff) {\n        return outOfBoundsChar;\n      }\n\n      if (code > 65535) {\n        return fromCodePoint(code);\n      }\n\n      return String.fromCharCode(numericUnicodeMap[code] || code);\n    }\n\n    return entities[entity.slice(1)] || entity;\n  });\n}\n\nexport function decodeHTMLEntitiesDeep<T>(input: T): T {\n  if (typeof input === 'string') {\n    return decodeHTMLEntities(input) as unknown as T;\n  }\n\n  if (typeof input === 'object') {\n    const correctType = Object.prototype.toString.apply(input);\n\n    if (correctType === '[object Array]') {\n      return (input as unknown[]).map((item) => {\n        return decodeHTMLEntitiesDeep(item);\n      }) as T;\n    }\n\n    if (correctType === '[object Object]') {\n      const response: Dictionary<unknown> = {};\n      Object.keys(input as Dictionary<unknown>).forEach((item) => {\n        response[decodeHTMLEntities(item)] = decodeHTMLEntitiesDeep(\n          (input as Dictionary<unknown>)[item],\n        );\n      });\n\n      return response as unknown as T;\n    }\n  }\n\n  return input;\n}\n\n/**\n * `decodeHTMLEntities` декодирует зарезервированные HTML-сущности.\n *\n * Если нужна возможность декодировать все сущности, используйте\n * {@link decodeHTMLFullEntities}\n *\n * @param input текст который необходимо декодировать\n * @param entities кастомный словарь сущностей `{'lt;': '<'}`\n */\nexport function decodeHTMLEntities(input: string, entities = namedEntities): string {\n  return decodeString(input, entities);\n}\n\n/**\n * `decodeHTMLFullEntities` декодирует все HTML-сущности.\n *\n * Если вам нужно декодировать не все сущности, используйте\n * {@link decodeHTMLEntities} и кастомный словарь.\n *\n * @param input текст который необходимо декодировать\n */\nexport function decodeHTMLFullEntities(input: string): string {\n  buildFullNamedEntities();\n\n  return decodeString(input, fullNamedEntities);\n}\n"],"mappings":"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"}