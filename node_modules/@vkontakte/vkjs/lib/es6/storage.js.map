{"version":3,"file":"storage.js","names":["CustomStorage","key","data","hasOwnProperty","Object","keys","val","String","id","length","index","dummyKey","dummyContent","ls","getLocalStorage","window","localStorage","setItem","getItem","Error","removeItem","e","clear","storage","getPrefixedKeys","prefix","filter","startsWith","sessionStorageCache","getSessionStorage","sessionStorage"],"sources":["../../src/storage.ts"],"sourcesContent":["import { Dictionary } from './types';\n\nclass CustomStorage {\n  private data: Dictionary<string> = {};\n\n  public setItem(key: string, val: string) {\n    this.data[key] = String(val);\n  }\n\n  public getItem = (key: string) => (this.data.hasOwnProperty(key) ? this.data[key] : null);\n\n  public removeItem(id: string) {\n    delete this.data[id];\n  }\n\n  public clear() {\n    this.data = {};\n  }\n\n  public get length() {\n    return Object.keys(this.data).length;\n  }\n\n  public key(index: number): string | null {\n    return Object.keys(this.data)[index];\n  }\n\n  public keys = (): string[] => Object.keys(this.data);\n}\n\nconst dummyKey = 'vk-ls-dummy';\nconst dummyContent = 'test';\n\nlet ls: CustomStorage | Storage;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport const localStorage = {\n  setItem: (key: string, val: string) => getLocalStorage().setItem(key, val),\n  getItem: (key: string) => getLocalStorage().getItem(key),\n  removeItem: (key: string) => getLocalStorage().removeItem(key),\n  clear: () => getLocalStorage().clear(),\n  length: () => getLocalStorage().length,\n  key: (index: number) => getLocalStorage().key(index),\n  keys(): string[] {\n    const storage = getLocalStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return localStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n\nlet sessionStorageCache: CustomStorage | Storage;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\n\nexport const sessionStorage = {\n  setItem: (key: string, val: string) => getSessionStorage().setItem(key, val),\n  getItem: (key: string) => getSessionStorage().getItem(key),\n  removeItem: (key: string) => getSessionStorage().removeItem(key),\n  clear: () => getSessionStorage().clear(),\n  length: () => getSessionStorage().length,\n  key: (index: number) => getSessionStorage().key(index),\n  keys(): string[] {\n    const storage = getSessionStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return sessionStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n"],"mappings":"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"}