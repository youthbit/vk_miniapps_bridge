{"version":3,"file":"animate.js","names":["canUseDOM","canUseEventListeners","animate","duration","timing","draw","start","window","performance","now","requestAnimationFrame","time","timeFraction","progress","animationEvent","supported","name","transitionEvent","AnimationEvent","WebKitAnimationEvent","TransitionEvent","WebKitTransitionEvent","waitAnimationEnd","listener","fallbackTime","el","addEventListener","setTimeout","cancelWaitAnimationEnd","handle","removeEventListener","clearTimeout","waitTransitionEnd","cancelWaitTransitionEnd"],"sources":["../../src/animate.ts"],"sourcesContent":["import { canUseDOM, canUseEventListeners } from './dom';\nimport { SupportEvent } from './types';\n\ntype TimingInterface = (timeFraction: number) => number;\n\ntype DrawInterface = (progress: number) => void;\n\ninterface AnimateArgumentsInterface {\n  duration: number;\n  timing: TimingInterface;\n  draw: DrawInterface;\n}\n\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\nexport function animate({ duration, timing, draw }: AnimateArgumentsInterface) {\n  if (!canUseDOM) {\n    return;\n  }\n\n  const start = window.performance.now();\n\n  // eslint-disable-next-line no-shadow\n  window.requestAnimationFrame(function animate(time) {\n    let timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    const progress = timing(timeFraction);\n\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n}\n\n// WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\ndeclare const WebKitAnimationEvent: AnimationEvent;\ndeclare const WebKitTransitionEvent: TransitionEvent;\n\nexport const animationEvent: SupportEvent<'animationend'> = {\n  supported: false,\n  name: 'animationend',\n};\n\nexport const transitionEvent: SupportEvent<'transitionend'> = {\n  supported: false,\n  name: 'transitionend',\n};\n\nif (canUseDOM) {\n  if (typeof AnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n  } else if (typeof WebKitAnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n\n    // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n    animationEvent.name = 'webkitAnimationEnd' as unknown as 'animationend';\n  }\n\n  if (typeof TransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n  } else if (typeof WebKitTransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n\n    // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n    transitionEvent.name = 'webkitTransitionEnd' as unknown as 'transitionend';\n  }\n}\n\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  fallbackTime: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\nexport function cancelWaitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitTransitionEnd(\n  el: GlobalEventHandlers,\n  listener: (ev?: TransitionEvent) => any,\n  fallbackTime: number,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\nexport function cancelWaitTransitionEnd(\n  listener: (ev?: TransitionEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n"],"mappings":"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"}